# Actory - 行動直結型ナレッジOS 完全要件定義書

**バージョン**: 2.0.0  
**最終更新日**: 2024年12月21日  
**作成者**: Manus AI  
**プロジェクト名**: knowledge-os

---

## 目次

1. [プロダクト概要](#1-プロダクト概要)
2. [ビジョンとコンセプト](#2-ビジョンとコンセプト)
3. [ユーザーペルソナ](#3-ユーザーペルソナ)
4. [システムアーキテクチャ](#4-システムアーキテクチャ)
5. [データベース設計](#5-データベース設計)
6. [機能要件](#6-機能要件)
7. [画面設計](#7-画面設計)
8. [API設計](#8-api設計)
9. [AI機能詳細](#9-ai機能詳細)
10. [UI/UXデザイン仕様](#10-uiuxデザイン仕様)
11. [非機能要件](#11-非機能要件)
12. [開発履歴](#12-開発履歴)
13. [今後の拡張計画](#13-今後の拡張計画)

---

## 1. プロダクト概要

### 1.1 プロダクト名

**Actory**（アクトリー）- 行動直結型ナレッジOS

### 1.2 プロダクトの目的

Actoryは、音声録音から議事録生成、タスク管理、ナレッジ蓄積までをシームレスに統合した、AIファーストのプロダクティビティプラットフォームです。ユーザーが会議や打ち合わせを録音するだけで、AIが自動的に議事録を生成し、アクションアイテムを抽出してタスク化します。蓄積されたナレッジはRAG（Retrieval-Augmented Generation）により、AIチャットで即座に参照・活用できます。

**コンテキスト管理AIとしてのActory:**
Actoryは、Obsidianのような次世代のAIを目指し、勝手に毎日起きた録音をインポートして今日起きたことをナレッジとして蓄積してくれる、情報の一元管理が可能になる新しいプラットフォームです。コンテキストが溢れかえる時代、タスクが溢れかえり消えてしまう時代において、社内や個人のコンテキストの混乱を解決し、タスクが消える問題を解決することで、世の中をよりよくします。

### 1.3 コアバリュー

| 価値 | 説明 |
|------|------|
| **ワンタップ録音** | 複雑な操作なしに、タップ一つで録音を開始。会議に集中できる |
| **AI自動議事録** | 録音から自動的にプロフェッショナルな議事録を生成。手作業ゼロ |
| **タスク自動抽出** | 会話からアクションアイテムを自動抽出し、承認フローでタスク化 |
| **ナレッジRAG** | 蓄積された議事録をAIチャットで即座に検索・参照・活用 |
| **シームレス統合** | 録音→議事録→タスク→カレンダーまで一気通貫のワークフロー |
| **AI自動フォルダ管理** | AIがコンテキストを自動分割し、階層構造を自動生成・管理 |
| **情報の一元管理** | 録音、テキスト、外部サービス連携などすべての情報を一元管理 |
| **コンテキスト管理AI** | AIがユーザーの第二の脳となり、コンテキストを理解・整理・提案 |
| **Obsidian風リンク** | ファイル間の関連性を自動検出し、リンクで繋がりを可視化 |
| **コンテンツ生成支援** | 蓄積されたナレッジからNote、X、YouTube、Instagram、メルマガなどのコンテンツを生成 |

### 1.4 ターゲットユーザー

Actoryは、以下のようなユーザーを主なターゲットとしています。

1. **スタートアップ経営者・創業者**: 多忙な中で会議の記録と次のアクションを効率的に管理したい
2. **プロジェクトマネージャー**: 複数プロジェクトの進捗と議事録を一元管理したい
3. **コンサルタント・営業担当**: クライアントとの打ち合わせ内容を正確に記録・共有したい
4. **チームリーダー**: チームミーティングの決定事項とタスクを確実にフォローしたい

---

## 2. ビジョンとコンセプト

### 2.1 プロダクトビジョン

> 「会議を録音するだけで、すべてが動き出す」

Actoryは、ユーザーが会議や打ち合わせを録音するだけで、議事録の作成、タスクの抽出、リマインダーの設定、ナレッジの蓄積がすべて自動的に行われる世界を実現します。ユーザーは本来の業務に集中し、AIがバックオフィス業務を代行します。

**コンテキスト管理AIとしてのビジョン:**
> 「コンテキストが溢れかえる時代だからこそ、タスクが溢れかえり消えてしまう時代だからこそ。社内や個人のコンテキストぐちゃぐちゃ。タスクが消える問題を解決し、世の中をよりよく。」

Actoryは、ユーザーの第二の脳となり、AIがプロジェクトごとのユーザーの立場を理解し、会議毎にAIが立場を整えることによって、議事録を作る段階でのタスクが整理されていきます。AIとの対話を通じて、コンテキストやフォルダの階層構造を最適化し、ユーザーが雑な指示でも、過去のコンテキストを踏まえて適切にメールや返信を生成できる世界を目指します。

### 2.2 デザインコンセプト

Actoryのデザインは、以下の3つの原則に基づいています。

**1. ミニマリズム**
- 不要な要素を排除し、本質的な機能のみを提供
- ワンタップで主要機能にアクセス可能
- 視覚的なノイズを最小限に抑えたクリーンなUI

**2. ダークスタイリッシュ**
- ダークティール〜シアンのグラデーション背景
- 常時アニメーションする美しい背景
- 高コントラストで視認性の高いテキスト

**3. Apple風エレガンス**
- 滑らかなアニメーションとトランジション
- 直感的なジェスチャー操作
- 一貫したデザイン言語

**4. Notion風カスタマイズ性**
- ユーザーが自由にレイアウトをカスタマイズ可能
- ブロックベースの柔軟な編集体験
- オシャレで洗練されたデザイン

### 2.3 ブランドアイデンティティ

| 要素 | 仕様 |
|------|------|
| **ロゴ** | Actoryカスタムロゴ（透過背景） |
| **プライマリカラー** | シアン (#00D4AA) |
| **セカンダリカラー** | ティール (#0D7377) |
| **背景** | ダークグラデーション（#0a0f0f → #1a2f2f） |
| **アクセントカラー** | エメラルドグリーン (#10B981) |
| **フォント** | システムフォント（-apple-system, BlinkMacSystemFont） |

---

## 3. ユーザーペルソナ

### 3.1 ペルソナ1: スタートアップCEO 田中さん

| 属性 | 詳細 |
|------|------|
| **年齢** | 35歳 |
| **職業** | テック系スタートアップCEO |
| **課題** | 1日に5〜10件の会議があり、議事録を取る時間がない |
| **ゴール** | 会議の内容を漏れなく記録し、次のアクションを確実に実行したい |
| **利用シーン** | 投資家ミーティング、チーム1on1、クライアント打ち合わせ |

### 3.2 ペルソナ2: プロジェクトマネージャー 鈴木さん

| 属性 | 詳細 |
|------|------|
| **年齢** | 42歳 |
| **職業** | IT企業プロジェクトマネージャー |
| **課題** | 複数プロジェクトの進捗管理と議事録の整理に追われている |
| **ゴール** | プロジェクトごとにナレッジを蓄積し、過去の決定事項をすぐに参照したい |
| **利用シーン** | 定例会議、ステークホルダーレビュー、振り返りミーティング |

---

## 4. システムアーキテクチャ

### 4.1 技術スタック

| レイヤー | 技術 |
|----------|------|
| **フロントエンド** | Next.js 15+ (App Router) + React 19 + Tailwind CSS 4 |
| **バックエンド** | Next.js App Router (Server Actions / Route Handlers) |
| **データベース** | Turso (LibSQL) + Drizzle ORM |
| **認証** | BetterAuth |
| **決済** | Stripe |
| **ストレージ** | S3互換オブジェクトストレージ |
| **AI/ML** | OpenAI Whisper API, OpenAI GPT-4, Gemini API |
| **音声処理** | FFmpeg（音声分割） |

### 4.2 システム構成図

```
┌─────────────────────────────────────────────────────────────┐
│                      クライアント                           │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐       │
│  │  録音   │  │  AI     │  │カレンダー│  │プロジェクト│    │
│  │  画面   │  │ チャット │  │  画面   │  │  画面   │       │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘       │
│       │           │           │           │              │
│       └───────────┴───────────┴───────────┘              │
│                       │                                   │
│              Server Actions / API                         │
└───────────────────────┼───────────────────────────────────┘
                        │
                   HTTPS/WSS
                        │
┌───────────────────────┼───────────────────────────────────┐
│                  Next.js Server                           │
│  ┌─────────────────────────────────────────────────────┐ │
│  │               App Router / Server Actions            │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐          │ │
│  │  │BetterAuth│  │ Recording│  │   AI     │          │ │
│  │  │          │  │  Handler │  │  Handler │          │ │
│  │  └──────────┘  └──────────┘  └──────────┘          │ │
│  └─────────────────────────────────────────────────────┘ │
│                        │                                  │
│  ┌─────────────────────┼─────────────────────────────┐   │
│  │              External Services                     │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐        │   │
│  │  │ OpenAI   │  │  Gemini  │  │   S3     │        │   │
│  │  │ Whisper  │  │   API    │  │ Storage  │        │   │
│  │  └──────────┘  └──────────┘  └──────────┘        │   │
│  │  ┌──────────┐                                      │   │
│  │  │  Stripe  │                                      │   │
│  │  └──────────┘                                      │   │
│  └───────────────────────────────────────────────────┘   │
│                        │                                  │
│  ┌─────────────────────┼─────────────────────────────┐   │
│  │                  Database                          │   │
│  │  ┌──────────────────────────────────────────────┐ │   │
│  │  │              Turso (LibSQL)                  │ │   │
│  │  │  users | projects | files | meetingNotes     │ │   │
│  │  │  recordings | tasks | reminders | chat       │ │   │
│  │  └──────────────────────────────────────────────┘ │   │
│  └───────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────┘
```

### 4.3 データフロー

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│   録音   │───▶│   S3     │───▶│ Whisper  │───▶│  文字    │
│   開始   │    │ アップ   │    │   API    │    │  起こし  │
└──────────┘    └──────────┘    └──────────┘    └────┬─────┘
                                                     │
                                                     ▼
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  タスク  │◀───│  タスク  │◀───│  議事録  │◀───│   LLM    │
│  承認    │    │  候補    │    │   生成   │    │  処理    │
└────┬─────┘    └──────────┘    └──────────┘    └──────────┘
     │
     ▼
┌──────────┐    ┌──────────┐    ┌──────────┐
│カレンダー│───▶│リマインダー│───▶│   通知   │
│  表示    │    │   設定   │    │   送信   │
└──────────┘    └──────────┘    └──────────┘
```

---

## 5. データベース設計

### 5.1 ER図

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│    users    │       │  projects   │       │    files    │
├─────────────┤       ├─────────────┤       ├─────────────┤
│ id (PK)     │◀──┐   │ id (PK)     │◀──┐   │ id (PK)     │
│ openId      │   │   │ userId (FK) │───┘   │ userId (FK) │
│ name        │   │   │ name        │       │ projectId   │
│ email       │   │   │ description │◀──────│ (FK)        │
│ role        │   │   │ context     │       │ name        │
│ createdAt   │   │   │ color       │       │ fileType    │
│ updatedAt   │   │   │ isArchived  │       │ aiGenerated │
└─────────────┘   │   │ createdAt   │       │ createdAt   │
                  │   └─────────────┘       └──────┬──────┘
                  │                                │
                  │   ┌─────────────┐              │
                  │   │meetingNotes │◀─────────────┘
                  │   ├─────────────┤
                  │   │ id (PK)     │
                  │   │ userId (FK) │───┐
                  │   │ fileId (FK) │   │
                  │   │ projectId   │   │
                  │   │ recordingId │   │
                  │   │ title       │   │
                  │   │ summary     │   │
                  │   │ keyPoints   │   │
                  │   │ decisions   │   │
                  │   │ rawTranscription│
                  │   │ formattedMinutes│
                  │   │ shareToken  │   │
                  │   │ createdAt   │   │
                  │   └─────────────┘   │
                  │                     │
┌─────────────┐   │   ┌─────────────┐   │   ┌─────────────┐
│ recordings  │   │   │    tasks    │   │   │  reminders  │
├─────────────┤   │   ├─────────────┤   │   ├─────────────┤
│ id (PK)     │   │   │ id (PK)     │   │   │ id (PK)     │
│ userId (FK) │───┤   │ userId (FK) │───┤   │ taskId (FK) │
│ projectId   │   │   │ projectId   │   │   │ userId (FK) │
│ fileId      │   │   │ meetingNoteId│  │   │reminderType │
│ audioUrl    │   │   │ title       │   │   │ scheduledAt │
│ audioKey    │   │   │ description │   │   │ isSent      │
│ duration    │   │   │ status      │   │   │ createdAt   │
│ transcription│  │   │ priority    │   │   └─────────────┘
│ status      │   │   │ dueDate     │   │
│ createdAt   │   │   │ aiGenerated │   │   ┌─────────────┐
└─────────────┘   │   │ createdAt   │   │   │chatConversations│
                  │   └─────────────┘   │   ├─────────────┤
                  │                     │   │ id (PK)     │
                  │   ┌─────────────┐   │   │ userId (FK) │───┐
                  │   │taskCandidates│  │   │ title       │   │
                  │   ├─────────────┤   │   │lastMessageAt│   │
                  │   │ id (PK)     │   │   │ messageCount│   │
                  │   │ userId (FK) │───┘   │ createdAt   │   │
                  │   │ recordingId │       └─────────────┘   │
                  │   │ title       │                         │
                  │   │ description │       ┌─────────────┐   │
                  │   │suggestedDueDate│    │chatMessages │   │
                  │   │ isApproved  │       ├─────────────┤   │
                  │   │ createdAt   │       │ id (PK)     │   │
                  │   └─────────────┘       │conversationId│──┘
                  │                         │ userId (FK) │
                  └─────────────────────────│ role        │
                                            │ content     │
                                            │ sources     │
                                            │ createdAt   │
                                            └─────────────┘
```

### 5.2 テーブル定義

#### 5.2.1 users テーブル

※BetterAuthのスキーマ定義に従います（user, session, account, verification など）。以下は論理モデルとしての参照です。

ユーザー認証情報を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | ユーザーID |
| openId | VARCHAR(64) | NOT NULL, UNIQUE | OAuth識別子 |
| name | TEXT | - | ユーザー名 |
| email | VARCHAR(320) | - | メールアドレス |
| loginMethod | VARCHAR(64) | - | ログイン方法 |
| role | ENUM('user', 'admin') | DEFAULT 'user' | ユーザーロール |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |
| lastSignedIn | TIMESTAMP | DEFAULT NOW() | 最終ログイン日時 |

#### 5.2.2 projects テーブル

プロジェクト情報を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | プロジェクトID |
| userId | INT | NOT NULL, FK | 所有ユーザーID |
| name | VARCHAR(255) | NOT NULL | プロジェクト名 |
| description | TEXT | - | プロジェクト説明 |
| context | TEXT | - | 蓄積されたコンテキスト |
| color | VARCHAR(7) | DEFAULT '#007AFF' | テーマカラー |
| isArchived | BOOLEAN | DEFAULT FALSE | アーカイブフラグ |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.3 files テーブル

プロジェクト内のファイル（議事録コンテナ）を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | ファイルID |
| userId | INT | NOT NULL, FK | 所有ユーザーID |
| projectId | INT | NOT NULL, FK | 親プロジェクトID |
| name | VARCHAR(255) | NOT NULL | ファイル名 |
| description | TEXT | - | ファイル説明 |
| fileType | ENUM | DEFAULT 'meeting_notes' | ファイル種別 |
| parentFileId | INT | - | 親ファイルID（ネスト用） |
| aiGenerated | BOOLEAN | DEFAULT FALSE | AI自動生成フラグ |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.4 meetingNotes テーブル

議事録データを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 議事録ID |
| userId | INT | NOT NULL, FK | 所有ユーザーID |
| fileId | INT | NOT NULL, FK | 親ファイルID |
| projectId | INT | NOT NULL, FK | プロジェクトID |
| recordingId | INT | FK | 元録音ID |
| title | VARCHAR(500) | NOT NULL | 会議タイトル |
| summary | TEXT | - | AI生成要約 |
| keyPoints | TEXT | - | 重要ポイント（JSON） |
| decisions | TEXT | - | 決定事項（JSON） |
| actionItems | TEXT | - | アクションアイテム（JSON） |
| participants | TEXT | - | 参加者（JSON） |
| rawTranscription | TEXT | - | 生の文字起こし |
| formattedMinutes | TEXT | - | フォーマット済み議事録（Markdown） |
| agendaItems | TEXT | - | 議題一覧（JSON） |
| discussionDetails | TEXT | - | 詳細な議論内容（Markdown） |
| nextMeeting | TEXT | - | 次回会議情報 |
| additionalNotes | TEXT | - | 追加メモ |
| meetingDate | BIGINT | - | 会議日時（UTC timestamp） |
| duration | INT | - | 会議時間（秒） |
| shareToken | VARCHAR(255) | - | 共有トークン |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.5 recordings テーブル

音声録音データを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 録音ID |
| userId | INT | NOT NULL, FK | 所有ユーザーID |
| projectId | INT | FK | プロジェクトID |
| fileId | INT | FK | 関連ファイルID |
| audioUrl | VARCHAR(512) | NOT NULL | 音声ファイルURL |
| audioKey | VARCHAR(255) | NOT NULL | S3キー |
| duration | INT | - | 録音時間（秒） |
| transcription | TEXT | - | 文字起こしテキスト |
| structuredNotes | TEXT | - | 構造化メモ（JSON） |
| status | ENUM | DEFAULT 'uploading' | 処理ステータス |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

**statusの値:**
- `uploading`: アップロード中
- `transcribing`: 文字起こし中
- `processing`: AI処理中
- `completed`: 完了
- `failed`: 失敗

#### 5.2.6 tasks テーブル

タスクデータを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | タスクID |
| userId | INT | NOT NULL, FK | 所有ユーザーID |
| projectId | INT | FK | プロジェクトID |
| fileId | INT | FK | 関連ファイルID |
| meetingNoteId | INT | FK | 元議事録ID |
| recordingId | INT | FK | 元録音ID |
| title | VARCHAR(500) | NOT NULL | タスクタイトル |
| description | TEXT | - | タスク説明 |
| status | ENUM | DEFAULT 'pending' | タスクステータス |
| priority | ENUM | DEFAULT 'medium' | 優先度 |
| dueDate | BIGINT | - | 期限（UTC timestamp） |
| completedAt | BIGINT | - | 完了日時（UTC timestamp） |
| aiGenerated | BOOLEAN | DEFAULT FALSE | AI自動生成フラグ |
| aiConfidence | INT | - | AI信頼度（0-100） |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

**statusの値:**
- `pending`: 承認待ち
- `approved`: 承認済み
- `rejected`: 却下
- `completed`: 完了

**priorityの値:**
- `low`: 低
- `medium`: 中
- `high`: 高

#### 5.2.7 reminders テーブル

リマインダーを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | リマインダーID |
| taskId | INT | NOT NULL, FK | タスクID |
| userId | INT | NOT NULL, FK | ユーザーID |
| reminderType | ENUM | NOT NULL | リマインダー種別 |
| scheduledAt | BIGINT | NOT NULL | 予定日時（UTC timestamp） |
| isSent | BOOLEAN | DEFAULT FALSE | 送信済みフラグ |
| sentAt | BIGINT | - | 送信日時（UTC timestamp） |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |

**reminderTypeの値:**
- `3_days`: 3日前
- `1_day`: 1日前
- `12_hours`: 12時間前

#### 5.2.8 taskCandidates テーブル

AI生成タスク候補を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 候補ID |
| userId | INT | NOT NULL, FK | ユーザーID |
| recordingId | INT | NOT NULL, FK | 元録音ID |
| suggestedProjectId | INT | FK | 推奨プロジェクトID |
| suggestedFileId | INT | FK | 推奨ファイルID |
| title | VARCHAR(500) | NOT NULL | タスクタイトル |
| description | TEXT | - | タスク説明 |
| suggestedDueDate | BIGINT | - | 推奨期限 |
| suggestedPriority | ENUM | DEFAULT 'medium' | 推奨優先度 |
| aiConfidence | INT | - | AI信頼度（0-100） |
| isApproved | BOOLEAN | - | 承認状態（null=保留） |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |

#### 5.2.9 chatConversations テーブル

AIチャット会話を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 会話ID |
| userId | INT | NOT NULL, FK | ユーザーID |
| title | VARCHAR(255) | - | 会話タイトル |
| lastMessageAt | BIGINT | NOT NULL | 最終メッセージ日時 |
| messageCount | INT | DEFAULT 0 | メッセージ数 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.10 chatMessages テーブル

AIチャットメッセージを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | メッセージID |
| conversationId | INT | NOT NULL, FK | 会話ID |
| userId | INT | NOT NULL, FK | ユーザーID |
| role | ENUM('user', 'assistant') | NOT NULL | 発言者ロール |
| content | TEXT | NOT NULL | メッセージ内容 |
| sources | TEXT | - | 参照ナレッジ（JSON） |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |

#### 5.2.11 folderPermissions テーブル

フォルダ階層構造の権限管理を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 権限ID |
| fileId | INT | NOT NULL, FK | フォルダID |
| userId | INT | NOT NULL, FK | ユーザーID |
| permission | ENUM('read', 'write', 'admin') | DEFAULT 'read' | 権限種別 |
| googleAccountId | VARCHAR(255) | - | GoogleアカウントID |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.12 fileLinks テーブル

ファイル間のリンク関係を管理するテーブル（Obsidian風リンク）。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | リンクID |
| sourceFileId | INT | NOT NULL, FK | リンク元ファイルID |
| targetFileId | INT | NOT NULL, FK | リンク先ファイルID |
| linkType | ENUM('related', 'reference', 'parent', 'child') | DEFAULT 'related' | リンク種別 |
| strength | INT | DEFAULT 50 | 関連度（0-100） |
| aiGenerated | BOOLEAN | DEFAULT TRUE | AI自動生成フラグ |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |

#### 5.2.13 userRoles テーブル

プロジェクトごとのユーザーの立場・役割を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 役割ID |
| userId | INT | NOT NULL, FK | ユーザーID |
| projectId | INT | NOT NULL, FK | プロジェクトID |
| role | VARCHAR(255) | - | 役割名（例: プロジェクトマネージャー） |
| position | TEXT | - | 立場の説明 |
| context | TEXT | - | コンテキスト情報（JSON） |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.14 relationshipProfiles テーブル

相手との関係性と口調を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | プロフィールID |
| userId | INT | NOT NULL, FK | ユーザーID |
| contactName | VARCHAR(255) | NOT NULL | 相手の名前 |
| contactEmail | VARCHAR(320) | - | 相手のメールアドレス |
| contactSlackId | VARCHAR(255) | - | Slack ID |
| contactLineId | VARCHAR(255) | - | LINE ID |
| relationshipType | ENUM('superior', 'boss', 'peer', 'subordinate') | NOT NULL | 関係性種別 |
| tone | TEXT | - | 口調の詳細（JSON） |
| context | TEXT | - | 関係性のコンテキスト（JSON） |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.15 externalIntegrations テーブル

外部サービス連携情報を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 連携ID |
| userId | INT | NOT NULL, FK | ユーザーID |
| serviceType | ENUM('gmail', 'notion', 'google_calendar', 'obsidian', 'evernote', 'google_docs', 'line', 'slack', 'discord', 'zoom', 'google_meet') | NOT NULL | サービス種別 |
| accessToken | TEXT | - | アクセストークン（暗号化） |
| refreshToken | TEXT | - | リフレッシュトークン（暗号化） |
| serviceAccountId | VARCHAR(255) | - | サービスアカウントID |
| config | TEXT | - | 設定情報（JSON） |
| isActive | BOOLEAN | DEFAULT TRUE | 有効フラグ |
| lastSyncedAt | TIMESTAMP | - | 最終同期日時 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.16 importedContents テーブル

外部サービスからインポートしたコンテンツを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | コンテンツID |
| userId | INT | NOT NULL, FK | ユーザーID |
| projectId | INT | FK | プロジェクトID |
| fileId | INT | FK | ファイルID |
| integrationId | INT | FK | 連携ID |
| contentType | ENUM('email', 'notion_page', 'calendar_event', 'obsidian_note', 'evernote_note', 'google_doc', 'line_message', 'slack_message', 'discord_message') | NOT NULL | コンテンツ種別 |
| originalId | VARCHAR(255) | - | 元のサービスでのID |
| title | VARCHAR(500) | - | タイトル |
| content | TEXT | - | コンテンツ本文 |
| metadata | TEXT | - | メタデータ（JSON） |
| importedAt | TIMESTAMP | DEFAULT NOW() | インポート日時 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |

#### 5.2.17 contentGenerations テーブル

生成されたコンテンツを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 生成ID |
| userId | INT | NOT NULL, FK | ユーザーID |
| projectId | INT | FK | プロジェクトID |
| sourceFileIds | TEXT | - | 参照元ファイルID（JSON配列） |
| contentType | ENUM('note', 'x_post', 'youtube_script', 'instagram_post', 'mail_magazine') | NOT NULL | コンテンツ種別 |
| title | VARCHAR(500) | - | タイトル |
| content | TEXT | NOT NULL | コンテンツ本文 |
| status | ENUM('draft', 'published', 'archived') | DEFAULT 'draft' | ステータス |
| publishedAt | TIMESTAMP | - | 公開日時 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.18 contextManagementSessions テーブル

コンテキスト管理セッションを管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | セッションID |
| userId | INT | NOT NULL, FK | ユーザーID |
| targetFileIds | TEXT | - | 対象ファイルID（JSON配列） |
| questions | TEXT | - | AIが質問した内容（JSON配列） |
| answers | TEXT | - | ユーザーの回答（JSON配列） |
| contextUpdates | TEXT | - | コンテキスト更新内容（JSON） |
| status | ENUM('active', 'completed', 'archived') | DEFAULT 'active' | ステータス |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |
| updatedAt | TIMESTAMP | ON UPDATE NOW() | 更新日時 |

#### 5.2.19 onboardingResponses テーブル

オンボーディング時の回答を管理するテーブル。

| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | INT | PK, AUTO_INCREMENT | 回答ID |
| userId | INT | NOT NULL, FK | ユーザーID |
| planType | ENUM('one', 'company') | NOT NULL | プラン種別 |
| businessCount | INT | - | 事業数 |
| businessNames | TEXT | - | 事業名（JSON配列） |
| departmentCounts | TEXT | - | 各部の数（JSON） |
| departmentNames | TEXT | - | 部名（JSON） |
| mainPurpose | TEXT | - | 主な用途 |
| folderStructure | TEXT | - | 生成されたフォルダ構造（JSON） |
| completedAt | TIMESTAMP | - | 完了日時 |
| createdAt | TIMESTAMP | DEFAULT NOW() | 作成日時 |

---

## 6. 機能要件

### 6.1 音声録音機能

#### 6.1.1 ワンタップ録音

**機能概要**: ユーザーがタップ一つで録音を開始・停止できる機能。

**詳細要件**:
- 録音画面の中央にActoryロゴを配置
- ロゴをタップすると録音開始
- 録音中は再度タップで停止
- 録音中はロゴが音量に応じてスケール変化するアニメーション
- 背景グラデーションが常時ゆらゆらとアニメーション
- 録音中は音声波形（細い線のなみなみ）を表示
- 右下に「キャンセル」ボタンを配置

**技術仕様**:
- MediaRecorder APIを使用
- 音声フォーマット: WebM (audio/webm)
- サンプリングレート: 48kHz
- 最大録音時間: 制限なし
- 最大ファイルサイズ: 50MB

#### 6.1.2 バックグラウンド録音

**機能概要**: 他のページに移動しても録音が継続する機能。

**詳細要件**:
- RecordingContextでグローバル状態管理
- 録音中は画面上部に録音インジケーターを表示
- インジケーターをタップすると録音画面に戻る
- 録音時間をリアルタイム表示

**技術仕様**:
- React Context APIを使用
- MediaRecorderインスタンスをグローバルに保持
- ページ遷移時もストリームを維持

#### 6.1.3 音声ファイルインポート

**機能概要**: 既存の音声ファイルをアップロードして議事録化する機能。

**詳細要件**:
- ドラッグ&ドロップまたはファイル選択でアップロード
- 対応フォーマット: MP3, WAV, M4A, WebM, OGG
- 最大ファイルサイズ: 50MB
- アップロード中はプログレスバーを表示
- 処理中は段階的な進捗を表示（アップロード→文字起こし→AI処理）

**技術仕様**:
- 25MB以上のファイルはFFmpegで5分ごとに分割
- 分割した各チャンクをWhisper APIで文字起こし
- 文字起こし結果を統合して1つの議事録として作成

### 6.2 AI文字起こし機能

#### 6.2.1 音声文字起こし

**機能概要**: 録音された音声をテキストに変換する機能。

**詳細要件**:
- 日本語音声に最適化
- 高精度な文字起こし
- 話者の区別（可能な場合）
- 句読点の自動挿入

**技術仕様**:
- 優先順位: OpenAI Whisper API > Gemini API > Aqua Voice API
- 言語設定: 日本語（ja）
- レスポンスフォーマット: verbose_json
- 25MB制限を超える場合は自動分割処理

#### 6.2.2 大容量ファイル分割処理

**機能概要**: 25MBを超える音声ファイルを自動分割して処理する機能。

**詳細要件**:
- 25MB以上のファイルを自動検出
- 5分ごとにチャンク分割
- 各チャンクを個別に文字起こし
- 結果を統合して1つの議事録として出力

**技術仕様**:
- FFmpegを使用した音声分割
- 分割フォーマット: MP3 (128kbps)
- チャンクサイズ: 5分（300秒）
- 統合時に重複除去処理

### 6.3 AI議事録生成機能

#### 6.3.1 プロフェッショナル議事録生成

**機能概要**: 文字起こしデータからプロフェッショナルな議事録を自動生成する機能。

**詳細要件**:
- 情報を一切省略しない
- 構造化によって読みやすくする
- 第三者が読んでも完全に理解できる品質
- ビジネス文書としてそのまま提出・共有可能

**議事録の必須セクション**:
1. 会議タイトル
2. 日付・時間
3. 議題一覧
4. 議論内容（議題ごとにセクション分け）
5. 決定事項（Decision Summary）
6. アクションアイテム / To-Do
7. 次回会議
8. 追加メモ / 補足

**技術仕様**:
- OpenAI GPT-4を使用
- JSON Schema形式でレスポンス
- Markdown形式で出力

#### 6.3.2 AIプロジェクト自動振り分け

**機能概要**: 会話内容から適切なプロジェクトを判断し、自動的に振り分ける機能。

**詳細要件**:
- 既存プロジェクトの説明を参照
- 適切なプロジェクトがない場合は新規作成を提案
- プロジェクト名と説明を自動生成
- ファイル名も自動生成（日付_会議名形式）

**技術仕様**:
- LLMによるプロジェクトマッチング
- コンテキスト蓄積による精度向上
- 信頼度スコアの算出

### 6.4 タスク管理機能

#### 6.4.1 AIタスク自動抽出

**機能概要**: 議事録からアクションアイテムを自動抽出してタスク候補として提示する機能。

**詳細要件**:
- 会話内容から具体的なアクションを抽出
- 期限の推定（文脈から判断）
- 優先度の推定
- 担当者の推定（可能な場合）

**タスク名生成ルール**:
- 抽象的なタスク名は禁止（例: ❌「SNS投稿を作る」）
- 具体的で一目で何をすればいいかわかるタスク名（例: ✅「Instagram用の商品紹介画像3枚を作成する」）
- 動詞で終わる形式
- 成果物が明確

**技術仕様**:
- Function Callingを使用したタスク抽出
- JSON Schema形式でタスク情報を取得
- 信頼度スコア（0-100）の算出

#### 6.4.2 タスク承認フロー

**機能概要**: AI生成タスク候補を承認・却下するフロー。

**詳細要件**:
- 承認待ちタスクをカレンダー画面上部に表示
- 各タスクに承認/却下ボタン
- 承認時にプロジェクトと期限を確定
- 承認後のみタスクがカレンダーに追加
- 一括承認/却下機能

**技術仕様**:
- taskCandidatesテーブルで候補管理
- 承認時にtasksテーブルに移行
- リマインダー自動設定

#### 6.4.3 タスク編集機能

**機能概要**: タスクの詳細を編集する機能。

**詳細要件**:
- タスク名のインライン編集
- 期限の変更（円形ピッカー）
- 優先度の変更
- プロジェクトの変更
- 説明の編集
- 完了/未完了の切り替え

**技術仕様**:
- TaskEditDialogコンポーネント
- tRPC mutationで更新

#### 6.4.4 AIチャットからのタスク作成

**機能概要**: AIチャットの会話中にシームレスにタスクを作成する機能。

**詳細要件**:
- 「タスクを追加して」などの自然言語でタスク作成
- AIが自動的にタスク名、説明、期限、プロジェクトを判断
- 作成完了時に緑色のカードで通知
- 「確認」ボタンでカレンダーに遷移

**技術仕様**:
- OpenAI Function Callingを使用
- create_taskツールを定義
- タスク作成後にカレンダーとタスク一覧に即座に反映

### 6.5 カレンダー機能

#### 6.5.1 カレンダー表示

**機能概要**: Apple Calendar風のカレンダーでタスクを表示する機能。

**詳細要件**:
- 月間カレンダー表示
- 日付セルにタスク数を丸で表示
- 日付をタップするとその日のタスク一覧を表示
- 今日の日付をハイライト
- 前月/翌月への移動

**技術仕様**:
- カスタムカレンダーコンポーネント
- タスクを期限でグループ化
- レスポンシブデザイン

#### 6.5.2 タスク一覧表示

**機能概要**: カレンダー右側にタスク一覧を表示する機能。

**詳細要件**:
- 選択した日付のタスクを表示
- 「すべてのタスク」セクションで全タスクを表示
- タスク名の横に説明文を小さく表示
- 優先度をカラーバッジで表示
- タップでタスク編集ダイアログを開く

**技術仕様**:
- 期限が早い順にソート
- 優先度でフィルタリング可能
- 完了タスクの表示/非表示切り替え

### 6.6 プロジェクト管理機能

#### 6.6.1 プロジェクト一覧

**機能概要**: プロジェクトを一覧表示する機能。

**詳細要件**:
- カード形式でプロジェクトを表示
- プロジェクト名、説明、タスク数を表示
- カラーテーマをカスタマイズ可能
- アーカイブ機能

**技術仕様**:
- グリッドレイアウト
- ソート機能（作成日、更新日、名前）

#### 6.6.2 プロジェクト詳細

**機能概要**: プロジェクト内のファイルと議事録を表示する機能。

**詳細要件**:
- プロジェクト > ファイル > 議事録の階層表示
- トグルで開閉（1回押して開く、もう1回押して閉じる）
- 議事録をタップで全文表示
- 議事録の共有機能

**技術仕様**:
- アコーディオンUIコンポーネント
- 遅延読み込みで大量データに対応

#### 6.6.3 議事録表示

**機能概要**: 議事録を構造化された形式で表示する機能。

**詳細要件**:
- 要約、キーポイント、決定事項を構造化表示
- 議論内容を詳細に表示
- アクションアイテムをリスト表示
- 文字起こしデータは折りたたみで表示
- ハッシュタグ（####）や表区切り（:---）を削除して見やすく

**技術仕様**:
- Markdown形式で保存
- フロントエンドでパースして表示
- 既存議事録も動的にフォーマット生成

#### 6.6.4 議事録共有機能

**機能概要**: 議事録を誰でも見れるリンクで共有する機能。

**詳細要件**:
- 共有トークンを生成
- 共有リンクをコピー
- 共有ページにActoryロゴと導線を表示
- 認証不要でアクセス可能

**技術仕様**:
- nanoidで16文字のトークン生成
- publicProcedureで共有ページを提供
- shareTokenカラムで管理

#### 6.6.5 議事録エクスポート機能

**機能概要**: プロジェクト内の議事録・文字起こしを一括エクスポートする機能。

**詳細要件**:
- Markdown形式でエクスポート
- すべての議事録を1ファイルにまとめる
- 文字起こしデータも含める
- ダウンロードボタンで取得

**技術仕様**:
- クライアントサイドでMarkdown生成
- Blobを使用したダウンロード

### 6.7 AIチャット機能

#### 6.7.1 RAGナレッジ検索

**機能概要**: 蓄積された議事録をAIチャットで検索・参照する機能。

**詳細要件**:
- ユーザーの質問に関連するナレッジを自動検索
- 関連性の高いナレッジのみを参照（最大3件）
- 参照したナレッジをトグルで表示
- 引用元（プロジェクト、ファイル、議事録）を明示

**RAG精度向上の仕組み**:
- メインキーワード（3文字以上）のマッチングを強化
- ストップワードを除外
- タイトル、プロジェクト名、要約、全文の順でスコアリング
- 閾値（最高スコアの50%以上）でフィルタリング
- メインキーワードが1つもマッチしない場合は除外

**技術仕様**:
- getKnowledgeForRAG関数でナレッジ取得
- スコアリングアルゴリズムで関連度計算
- 最大3件に制限

#### 6.7.2 AIチャット会話

**機能概要**: AIとの対話形式でナレッジを活用する機能。

**詳細要件**:
- メッセージ入力欄を画面の一番下に固定
- 会話履歴を保存
- 過去の会話を引き継ぎ可能
- 参照したナレッジをメッセージ下に表示

**技術仕様**:
- chatConversationsとchatMessagesテーブルで管理
- tRPC mutationで会話を処理
- OpenAI GPT-4を使用

#### 6.7.3 会話履歴

**機能概要**: 過去のAIチャット会話を管理する機能。

**詳細要件**:
- 会話一覧を表示（最新順）
- 会話をタップすると履歴を読み込み
- 会話タイトルは最初のメッセージから自動生成
- メッセージ数を表示

**技術仕様**:
- getChatConversationsByUser関数で取得
- getChatMessagesByConversation関数でメッセージ取得
- sourcesカラムで参照ナレッジを保存

### 6.8 Nottaベンチマーク機能ギャップ（Cursor lines 954-1095）

Nottaの主要機能（`docs/cursor_.md` 954行目以降の `$主な機能` セクション）をActory視点で再整理し、実装状況と今後の方針を明記する。今後はこの一覧を基準に要件とタスクを更新する。

#### 6.8.1 音声認識・文字起こし

| 機能 | 現状 | 実装メモ |
|------|------|----------|
| リアルタイム文字起こし | 未実装 | WebRTC/MediaStreamを`/api/realtime-transcription` WebSocketにストリーミングし、OpenAI RealtimeまたはDeepgram APIへプロキシ。部分文字起こしをIndexedDBに蓄積し、UIへDiff配信する。 |
| 話者識別（ダイアライゼーション） | 未実装 | `pyannote.audio` または AssemblyAI Speaker Diarization APIを利用して録音チャンクごとにspeakerタグを付与。`recordingSegments`テーブルを追加しUIで色分け表示する。 |
| ブックマーク/ハイライト | スキーマのみ（UI未実装） | `bookmarks`/`highlights`テーブルを活用し、Recorder UI／Transcript UIに「★」「ハイライト」ボタンを追加。タイムスタンプとテキスト範囲を保存し、サイドパネルで一覧化する。 |
| 録音アップ（Notta Memo相当） | 部分実装（Webブラウザ録音/アップロードは対応） | モバイルPWA対応と専用エンドポイント`POST /api/recordings/mobile`を追加。Notta Memo互換デバイスには事前署名URLを払い出し、直接アップロードを許可する。 |

#### 6.8.2 AI要約・分析

| 機能 | 現状 | 実装メモ |
|------|------|----------|
| AI要約テンプレート | 基本的な一括要約のみ | `summaryTemplates`テーブルとUIを追加し、LLMプロンプトをテンプレート化。録音完了時にテンプレを選択して複数フォーマットの要約を生成する。 |
| カスタムAIプロンプト | 未実装 | Enterprise設定に`customPrompts`テーブルを接続し、LLM呼び出し時にユーザー独自プロンプトをチェーンに挿入できるようにする。 |
| AIノート→マインドマップ | 未実装 | Transcript構造をJSONで抽出し、フロントで`react-flow`や`elkjs`を用いてマインドマップ描画。PNG/SVGエクスポートにも対応する。 |
| 週間レポート | 未実装 | Edge Cronで直近7日間の会議データを集計し、`weekly_reports`に保存。Charts.js + PDFエクスポートで可視化する。 |
| AIチャット | 実装済（RAG） | 追加対応としてマルチ録音検索範囲やJira/メール草案などの自動アクションテンプレートを`@/server/actions/chat`に拡張する。 |

#### 6.8.3 会議参加・スケジューリング

| 機能 | 現状 | 実装メモ |
|------|------|----------|
| カレンダー同期 | UIのみ（データ連携なし） | Google/Outlook OAuth連携を追加し、`calendarIntegrations`/`calendarEvents`テーブルに実データを保存。Webhookで会議リンク取得→Recorderへ連携。 |
| 手動参加（URL経由） | 未実装 | 「Record online meeting」モーダルを追加し、会議URLを保存。Botワーカー（例: Cloud Run）にジョブ投入してリアルタイム文字起こしを開始。 |
| 自動参加ワークフロー | 未実装 | カレンダーイベントとBotジョブを紐付け、Workerで定刻にブラウザレスJoin（Puppeteer + Zoom/Meet SDK）を実行。開始/終了で録音処理を自動化。 |
| ミーティングスケジューラー | 未実装 | Cal.comライクなスロットUIをNext.jsで構築。Google Calendar APIで空き時間判定→予約ページを生成し、参加者双方のカレンダーに反映する。 |

#### 6.8.4 編集・共有・検索

| 機能 | 現状 | 実装メモ |
|------|------|----------|
| 編集と注釈 (@メンション) | 未実装 | TiptapベースのTranscriptエディタを導入。コメント/メンションは`comments`テーブルに保存し、リアルタイム更新用にPusher/SSEを使用。 |
| 検索・スニペット | 部分実装（RAGのみ） | Transcript内の任意範囲をスニペット化してタグ付け。`smart-search`パネルでフィルタと音声ジャンプを実装。 |
| フォルダー管理と共有 | スキーマのみ（UI未実装） | `files.parentFileId`を利用してツリーUIを実装。共有リンク生成API＋Slack/Notion/CRM Webhook送信を組み込む。 |
| エクスポート (TXT/PDF/SRT/DOCX) | 実装済 | 追加要望としてマインドマップPNGや週次レポートPDFも`/server/actions/export.ts`に拡張する。 |

#### 6.8.5 その他

| 機能 | 現状 | 実装メモ |
|------|------|----------|
| インテグレーション | 未実装 | Slack/Notion/HubSpot/Salesforce用OAuth + Webhook設定UIを`/settings/integrations`に追加し、議事録完了時の自動送信を実現。 |
| クロスデバイス同期 | 未実装 | PWA + React Nativeで録音/トランスクリプトを同期。Supabase Storage/Tursoを活用し、オフライン時はIndexedDBに保存→再同期。 |
| データセキュリティ | 未実装 | ISO27001/SOC2向けに`audit_logs`を実装、S3 SSE-KMSやRow-Level Encryptionを設定。ポリシー文書とDPAを整備。 |
| オンボーディング/UX強化 | 部分実装 | 初回ログイン時のオンボーディングツアー、セットアップチェックリスト、モバイル最適化タスクをUI側に追加する。 |

#### 6.7.4 ナレッジ参照トグル

**機能概要**: AIの回答で参照したナレッジを表示するトグル機能。

**詳細要件**:
- 「N件のナレッジを参照」トグルを表示
- トグルを開くと引用元の詳細を表示
- プロジェクト名 > ファイル名 > 議事録タイトルの階層表示
- 引用箇所として具体的なテキスト抜粋を表示
- 「議事録を見る」ボタンで議事録に直接遷移

**技術仕様**:
- sourcesをJSON形式で保存
- 議事録遷移時はクエリパラメータで議事録IDを渡す
- 遷移先で議事録モーダルを自動オープン

### 6.8 ホーム画面機能

#### 6.8.1 ダッシュボード表示

**機能概要**: ユーザーの主要情報をダッシュボード形式で表示する機能。

**詳細要件**:
- 挨拶メッセージ（時間帯に応じて変化）
- 「音声メモを録音」ボタン（Actoryロゴ付き）
- 「音声メモをインポート」ボタン
- 「今日のタスク」セクション
- 「今後の予定」セクション

**技術仕様**:
- DashboardLayoutコンポーネントを使用
- tRPCクエリでデータ取得

#### 6.8.2 今日のタスク

**機能概要**: 今日期限のタスクを表示する機能。

**詳細要件**:
- 今日が期限のタスクをリスト表示
- タスク名と時刻を表示
- 「すべて見る」リンクでカレンダーに遷移

**技術仕様**:
- getApprovedTasksInRange関数で取得
- 今日の0時〜23:59:59でフィルタリング

#### 6.8.3 今後の予定

**機能概要**: 今後のタスクを表示する機能。

**詳細要件**:
- 締め切りが近い順に表示
- タスク名、日付、プロジェクト名を表示
- プロジェクト名をバッジで表示
- 最大5件を表示

**技術仕様**:
- 期限でソート
- プロジェクト情報をJOINで取得

### 6.9 リマインダー機能

#### 6.9.1 自動リマインダー設定

**機能概要**: タスク承認時に自動的にリマインダーを設定する機能。

**詳細要件**:
- 3日前リマインダー
- 1日前リマインダー
- 12時間前リマインダー

**技術仕様**:
- createReminders関数で一括作成
- scheduledAtで予定日時を管理
- isSentで送信済みフラグを管理

#### 6.9.2 通知送信

**機能概要**: リマインダーに基づいて通知を送信する機能。

**詳細要件**:
- 予定時刻に通知を送信
- オーナーに通知
- 重要タスク生成時も通知

**技術仕様**:
- notifyOwner関数を使用
- Manus通知APIを利用

### 6.10 AI自動フォルダ管理機能

#### 6.10.1 階層構造の自動生成

**機能概要**: AIがコンテキストを自動分割し、フォルダの階層構造を自動生成・管理する機能。

**詳細要件**:
- 最上流のフォルダ（プロジェクト）はユーザーが作成
  - 例: Aircle, SlideBox, Genspark など
- その下流のフォルダはAIが自動生成
  - 例: Aircle > オンラインイベント企画 > 2025-12-27 Vimmerさんイベント
- 録音や議事録の内容から適切な階層構造を自動判断
- ユーザーが手動で階層構造を調整可能
- 自動分類が間違っていた場合、ユーザーの修正をAIが学習
- 階層の深さは最大4段階まで
- スキップ機能で自動分類をスキップ可能

**技術仕様**:
- LLMによるコンテキスト分析
- 既存のフォルダ構造を参照して一貫性を保持
- ユーザーの修正履歴を学習データとして蓄積
- filesテーブルのparentFileIdを活用した階層管理

#### 6.10.2 録音時のプロジェクト選択

**機能概要**: 録音時にプロジェクトと階層構造を選択する機能。

**詳細要件**:
- 録音開始前にプロジェクトを選択
- 選択したプロジェクトの階層構造を表示
- 階層構造の中から適切な位置を選択
- スキップ機能で後から分類可能
- ユーザーの意思でコンテキストを調整可能

**技術仕様**:
- プロジェクト選択UI
- 階層構造のツリービュー表示
- 選択情報をrecordingテーブルに保存

### 6.11 オンボーディング機能

#### 6.11.1 初期設定フロー

**機能概要**: 初回ログイン時に事業構造を聞いて自動でフォルダ階層構造を生成する機能。

**詳細要件**:
- 事業が何個あるかを質問（最大10個まで）
- 各事業名を入力
- 各事業に部が何個あるかを選択式で質問（各事業ごとに異なる部数を設定可能）
- 何を主にまとめたいかを質問
- 回答に基づいて自動でフォルダ階層構造を生成
- 個人用とチーム用をボタンで自由に切り替え可能
- 個人用では個人のデータを蓄積
- チーム用ではチーム全体でデータを共有
- 個人用で作成した議事録をチーム用にも追加可能

**Actory for one / Actory for company:**
- Actory for one: 個人向けプラン
- Actory for company: 組織向けプラン
- プランに応じてオンボーディングフローを変更
- 個人用とチーム用を自由にボタンで切り替え可能

**技術仕様**:
- ステップバイステップのオンボーディングUI
- 回答をデータベースに保存
- フォルダ構造の自動生成API

### 6.12 組織共有機能

#### 6.12.1 フォルダ階層構造の権限管理

**機能概要**: フォルダ階層構造にGoogleアカウントの認証権限を付与する機能。

**詳細要件**:
- 各フォルダ階層にGoogleアカウントの認証権限を設定
- Googleアカウントでログインしているユーザー間でのみ共有可能
- 読み取り専用、編集可能、管理者の3段階の権限
- 組織内での共有を可能にする
- チームとして管理し、AIが自動で共有設定を最適化
- 1年以上経過した情報は自動でアーカイブ化
- 削除は自動では行わない（ユーザーが手動で削除）

**技術仕様**:
- Google OAuth連携
- 権限管理テーブルの追加
- フォルダ単位での権限設定

### 6.13 コンテキスト管理機能

#### 6.13.1 AIコンテキスト整理

**機能概要**: AIが質問してコンテキストを整理し、ユーザーの第二の脳となる機能。

**詳細要件**:
- 「コンテキストを管理」ボタンでAIとの対話を開始
- ボタンの配置場所：
  - ホーム画面の目立つ場所
  - プロジェクト詳細画面
  - コンテキスト管理画面
- AIが不明点や「これどうなりました？」などを質問
- 毎日自動でAIの質問を表示
- その都度コンテキストを話しながら整理
- AIが理解に基づいてRAGに都度回答を蓄積
- ユーザーの第二の脳として機能

**技術仕様**:
- コンテキスト管理専用のAIチャット
- その日に追加された議事録や文字起こしデータを分析
- 「これはここのファイル直下？」「この関係性はこう？」「これはあなたのタスク？」などの質問を自動生成
- 毎日自動で質問を生成するスケジューラー

#### 6.13.2 プロジェクトごとの立場理解

**機能概要**: AIがプロジェクトごとのユーザーの立場を理解する機能。

**詳細要件**:
- プロジェクトごとにユーザーの立場を学習
- 会議毎にAIが立場を整える
- 議事録作成段階でのタスクが整理される
- 立場に基づいた適切な議事録生成

**技術仕様**:
- プロジェクトごとのコンテキスト蓄積
- ユーザーの役割・立場の学習
- 立場に基づいた議事録生成プロンプトの調整

### 6.14 外部サービス連携機能

#### 6.14.1 会議ツール連携

**機能概要**: Google MeetやZoomなどの会議ツールに自動参加する機能。

**詳細要件**:
- Google Meetへの自動参加
- Zoomへの自動参加
- 会議中の自動録音
- 会議終了後の自動議事録生成

**技術仕様**:
- Google Meet API連携
- Zoom API連携
- 自動参加ボットの実装

#### 6.14.2 テキストインポート機能

**機能概要**: 外部サービスから大量のテキストをインポートして自動整理する機能。

**対応サービス**:
- Notion（優先度：高）- ページをインポートしてAIが再構成
- Slack（優先度：高）
- Gmail（優先度：中）- 後から実装
- Googleカレンダー
- Obsidian
- Evernote
- メモ帳
- Googleドキュメント
- LINE
- Discord

**詳細要件**:
- 何万字でも対応可能な大量テキストインポート
- Notionのフォルダ構造をそのまま持ってくるのは難しいため、ページをインポートしてAIが再構成
- Notion連携専用ページを作成
- AIが自動で整理してフォルダに分類
- AIとの対話でコンテキストやフォルダの階層構造を最適化
- 過去のデータを一括インポート可能

**技術仕様**:
- 各サービスのAPI連携
- Notion APIによるページインポート
- バッチ処理による大量データのインポート
- AIによる自動分類・再構成アルゴリズム

#### 6.14.3 口調管理機能

**機能概要**: 相手との関係性に応じた口調を管理する機能。

**詳細要件**:
- 相手との関係性を4段階で分類
  1. 最上級の目上の人
  2. 上司
  3. 仲間、友達（同期）
  4. 部下
- 過去のメッセージを見て自動で学習
- Slack、LINE、Discordでの相手に対する口調を学習
- メールやLINEを返す時に適切な口調で返信
- 口調情報をコンテキストに蓄積
- プロジェクトごとの口調変更は不要（全プロジェクト共通）

**技術仕様**:
- 関係性管理テーブル
- 過去のメッセージ履歴を分析して自動学習
- 口調学習アルゴリズム
- メール・LINE返信時の口調適用

### 6.15 Obsidian風リンク機能

**注意**: この機能は優先度を下げ、一旦実装しない。将来的な拡張として検討する。

### 6.16 コンテンツ生成機能

#### 6.16.1 AIコンテンツ提案

**機能概要**: 蓄積されたナレッジからコンテンツ生成を提案する機能。

**詳細要件**:
- Note、X、YouTube、Instagram、メルマガなどのコンテンツを生成
- ユーザーの口調や文体を学習して、ユーザーが一から作ったみたいなコンテンツを生成
- 生成されたコンテンツはそのまま使えるが、ユーザーが編集してから使うことを前提
- 蓄積されたナレッジを活用したコンテンツ生成
- コンテンツごとにフォルダに自動分類

**AI提案のタイミング**:
1. **議事録生成直後**: 
   - 「これ図解にしてチームに共有しますか？」
   - 「PDFでマニュアル化したりしますか？」
   - など、議事録の内容に応じた具体的な提案
   - 議事録の内容を分析して、適切なコンテンツ形式を自動判断
2. **週次提案（1週間に1回程度）**:
   - 「この経験使う？」という形で、過去1週間の議事録からコンテンツ生成を提案
   - 重要な決定事項や経験談を自動で抽出して提案
   - Note、X、YouTube、Instagram、メルマガなどの形式を提案

**技術仕様**:
- コンテンツ生成用のLLMプロンプト
- ユーザーの口調・文体を学習するアルゴリズム
- テンプレート管理
- コンテンツ種別ごとの最適化

#### 6.16.2 過去データ一括インポート

**機能概要**: 初回セットアップ時に過去のデータを一括インポートする機能。

**詳細要件**:
- 過去の録音、テキスト、議事録などを一括インポート
- AIがコンテンツごとにフォルダに自動分類
- インポート後のコンテキスト整理

**技術仕様**:
- バッチインポートAPI
- 進捗表示
- エラーハンドリング

### 6.17 メール・返信生成機能

#### 6.17.1 コンテキストベースの返信生成

**機能概要**: 過去のコンテキストを踏まえてメールや返信を自動生成する機能。

**詳細要件**:
- 雑な指示でも適切な返信を生成
- 「ここからこんなメールきた返してて」などの指示に対応
- 過去の会話やコンテキストを参照
- 口調を適切に適用

**技術仕様**:
- RAGによる過去コンテキストの参照
- メール生成用のLLMプロンプト
- 口調管理との連携

### 6.18 モバイルアプリ機能

#### 6.18.1 スマホアプリ版

**機能概要**: iOS/Android向けのネイティブアプリ。

**詳細要件**:
- Web版を先にリリースし、その後スマホアプリ版をリリース
- 毎日自動録音機能
  - 朝9時に自動で録音開始
  - 夜20時まで裏で自動録音
  - 無限に自動で録音（ユーザーが停止するまで）
- バックグラウンド録音対応
- Web版とのデータ同期

**技術仕様**:
- React NativeまたはFlutter
- バックグラウンドタスク（iOS: Background Audio, Android: Foreground Service）
- プッシュ通知
- ProudNotePinなどの既存ツールの技術スタックを参考に実装

**iOSバックグラウンド録音**:
- Background Audio モードを使用
- Info.plistに`UIBackgroundModes: audio`を設定
- AVAudioSessionで録音セッションを維持
- バッテリー消費に注意が必要

**Androidバックグラウンド録音**:
- Foreground Serviceを使用（通知を表示し続ける必要がある）
- MediaRecorder APIで録音
- バッテリー最適化の除外設定が必要
- 定期的にサーバーにアップロードする必要がある

#### 6.18.2 Apple Watch録音機能

**機能概要**: Apple Watchを使用して長時間録音を継続する機能。

**詳細要件**:
- Apple Watchアプリで録音を開始・停止
- 朝9時に自動で録音開始
- 夜20時まで裏で自動録音
- iPhoneとBluetoothで接続してデータを同期
- 録音データを自動的にサーバーにアップロード

**技術仕様**:
- watchOSアプリ開発（Swift/SwiftUI）
- WatchConnectivityフレームワークでiPhoneと通信
- AVAudioRecorderを使用した録音
- バックグラウンドタスクの制約:
  - watchOSではバックグラウンド実行時間が制限される（通常15分程度）
  - 長時間録音にはWatch App Extensionが必要
  - バッテリー消費を最小限に抑える最適化が必要
- データ転送:
  - Wi-FiまたはBluetooth接続を利用
  - iPhone経由でサーバーにアップロード
  - iCloud同期も検討
- バッテリー管理:
  - Apple Watch Ultra 2のバッテリー駆動時間は通常使用で最大36時間
  - 長時間録音時は充電が必要になる可能性がある
  - バッテリー残量を監視してユーザーに通知

**参考アプリ**:
- AVR PRO: 高品質な音声録音、バックグラウンド録音、無制限の録音時間
- Smart Recorder: バックグラウンド録音、Bluetooth対応、クラウドへのアップロード機能

**注意点**:
- watchOSのバックグラウンド実行制限により、完全な長時間録音は難しい可能性がある
- iPhoneと常に接続している必要がある
- バッテリー消費が大きいため、ユーザーに適切な通知が必要

---

## 7. 画面設計

### 7.1 画面一覧

| 画面名 | パス | 説明 |
|--------|------|------|
| ホーム | / | ダッシュボード画面 |
| 録音 | /record | 音声録音画面 |
| インポート | /import | 音声ファイルインポート画面 |
| AIチャット | /chat | AIチャット画面 |
| カレンダー | /calendar | カレンダー・タスク管理画面 |
| プロジェクト一覧 | /projects | プロジェクト一覧画面 |
| プロジェクト詳細 | /projects/:id | プロジェクト詳細画面 |
| タスク確認 | /task-confirm/:recordingId | タスク候補確認画面 |
| 共有議事録 | /shared/:token | 公開議事録表示画面 |
| オンボーディング | /onboarding | 初回セットアップ画面 |
| コンテキスト管理 | /context-management | コンテキスト整理画面 |
| 外部連携設定 | /settings/integrations | 外部サービス連携設定画面 |
| 階層構造ビュー | /projects/:id/structure | 階層構造可視化画面 |
| リンクグラフ | /projects/:id/graph | Obsidian風リンクグラフ画面 |
| コンテンツ生成 | /content/generate | コンテンツ生成画面 |
| テキストインポート | /import/text | テキスト一括インポート画面 |

### 7.2 画面詳細

#### 7.2.1 ホーム画面 (/)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  12月21日 (日)                                          │
│  おはようございます、市岡直人                            │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [Actoryロゴ] 音声メモを録音                      │   │
│  │              タップして開始                      │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [アップロードアイコン] 音声メモをインポート      │   │
│  │                       既存の音声ファイルから議事録を作成│
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  今日のタスク                        すべて見る >       │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ● SNS投稿の準備                    22:28        │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  今後の予定                                             │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ● エイブルに電話する     12/22 (月)  [AirCle]   │   │
│  │ ● SNSマニュアル整備      12/26 (金)  [AirCle]   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.2 録音画面 (/record)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                                                         │
│                                                         │
│                                                         │
│                    [Actoryロゴ]                         │
│                                                         │
│                タップして録音開始                       │
│                                                         │
│                                                         │
│                                                         │
│                                                         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**録音中レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                                                         │
│                    ～～～～～～～～                      │
│                   (音声波形表示)                        │
│                                                         │
│                    [Actoryロゴ]                         │
│                   (スケールアニメーション)               │
│                                                         │
│                      02:34                              │
│                                                         │
│                                                         │
│                                          [キャンセル]   │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.3 AIチャット画面 (/chat)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────┐   │
│ │ [履歴]                                 [新規会話] │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ [Actoryロゴ]                                      │   │
│ │ こんにちは！何かお手伝いできることはありますか？  │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │                                         [ユーザー]│   │
│ │ 事業売却について教えて                            │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ [Actoryロゴ]                                      │   │
│ │ 事業売却に関する情報をお伝えします...             │   │
│ │                                                   │   │
│ │ ▼ 1件のナレッジを参照                            │   │
│ │ ┌─────────────────────────────────────────────┐   │   │
│ │ │ アークル関連プロジェクト > 事業売却決定     │   │   │
│ │ │ "事業売却が決定しました..."                 │   │   │
│ │ │                            [議事録を見る]   │   │   │
│ │ └─────────────────────────────────────────────┘   │   │
│ │                                                   │   │
│ │ ✓ タスクを作成しました                           │   │
│ │ ┌─────────────────────────────────────────────┐   │   │
│ │ │ 売却契約書の確認                            │   │   │
│ │ │ 12/25 (水) | 高優先度            [確認]     │   │   │
│ │ └─────────────────────────────────────────────┘   │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ メッセージを入力...                      [送信]   │   │
│ └───────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.4 カレンダー画面 (/calendar)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  承認待ちタスク (2件)                                   │
│  ┌─────────────────────────────────────────────────┐   │
│  │ SNS投稿の準備          [承認] [却下]            │   │
│  │ エイブルに電話する     [承認] [却下]            │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────┐  ┌─────────────────────────┐   │
│  │    2024年12月       │  │ 12月21日 (日)のタスク   │   │
│  │ 日 月 火 水 木 金 土 │  │                         │   │
│  │  1  2  3  4  5  6  7│  │ ● SNS投稿の準備         │   │
│  │  8  9 10 11 12 13 14│  │   明日までに...         │   │
│  │ 15 16 17 18 19 20●21│  │                         │   │
│  │ 22 23 24 25●26 27 28│  │                         │   │
│  │ 29 30 31            │  │                         │   │
│  └─────────────────────┘  │                         │   │
│                           │ すべてのタスク (3件)    │   │
│                           │                         │   │
│                           │ ● SNS投稿の準備         │   │
│                           │   明日までに...         │   │
│                           │ ● エイブルに電話する    │   │
│                           │   明後日エイブルに...   │   │
│                           │ ● SNSマニュアル整備     │   │
│                           │   投稿内容と...         │   │
│                           └─────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.5 プロジェクト詳細画面 (/projects/:id)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  < 戻る                                                 │
│                                                         │
│  アークル関連プロジェクト                               │
│  アークルに関するすべての会議と決定事項を管理           │
│                                                         │
│  ▼ 2025-12-19_事業売却決定                             │
│    ┌─────────────────────────────────────────────────┐ │
│    │ 事業売却決定                                    │ │
│    │ 2024/12/19                                      │ │
│    │                                                 │ │
│    │ 要約                                            │ │
│    │ 事業売却が正式に決定しました。契約書の確認と... │ │
│    │                                                 │ │
│    │ 決定事項                                        │ │
│    │ • 売却価格: XXXX万円                           │ │
│    │ • 契約締結日: 12/25                            │ │
│    │                                                 │ │
│    │ アクションアイテム                              │ │
│    │ • 契約書の最終確認                             │ │
│    │ • 関係者への通知                               │ │
│    │                                                 │ │
│    │ ▼ 文字起こしを表示                             │ │
│    │                                                 │ │
│    │ [共有リンクを生成]                             │ │
│    └─────────────────────────────────────────────────┘ │
│                                                         │
│  ▶ 2025-12-19_アークルミーティング                     │
│                                                         │
│  ▶ 2025-12-19_エアコン修理                             │
│                                                         │
│  [エクスポート]                                         │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.6 オンボーディング画面 (/onboarding)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│                    [Actoryロゴ]                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ようこそ、Actoryへ                                     │
│                                                         │
│  まず、あなたの事業について教えてください                │
│                                                         │
│  事業は何個ありますか？                                  │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [  3  ] 個                                      │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  各事業の名前を教えてください                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 事業1: [Aircle        ]                          │   │
│  │ 事業2: [SlideBox      ]                          │   │
│  │ 事業3: [Genspark      ]                          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [次へ]                                                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.7 コンテキスト管理画面 (/context-management)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  コンテキストを管理                                     │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [Actoryロゴ]                                      │   │
│  │ 今日追加された議事録を確認しました。              │   │
│  │                                                   │   │
│  │ 質問: これは「Aircle > オンラインイベント企画」   │   │
│  │       のファイル直下に配置しますか？             │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [ユーザー]                                        │   │
│  │ はい、その通りです                                 │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [Actoryロゴ]                                      │   │
│  │ 了解しました。他に整理したいことはありますか？    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ メッセージを入力...                      [送信]   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.8 階層構造ビュー画面 (/projects/:id/structure)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Aircle の階層構造                                      │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 📁 Aircle                                        │   │
│  │   └─ 📁 オンラインイベント企画                   │   │
│  │       └─ 📄 2025-12-27 Vimmerさんイベント      │   │
│  │   └─ 📁 事業売却                                 │   │
│  │       └─ 📄 2024-12-19 事業売却決定            │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [AIと対話して構造を調整]                                │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.9 リンクグラフ画面 (/projects/:id/graph)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Aircle のリンクグラフ                                 │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │                                                   │   │
│  │        [事業売却決定]                             │   │
│  │              │                                     │   │
│  │              │                                     │   │
│  │        [Vimmerイベント] ←→ [オンライン企画]      │   │
│  │              │                                     │   │
│  │              └─→ [契約書確認]                      │   │
│  │                                                   │   │
│  │  (Obsidian風のグラフビュー)                       │   │
│  │                                                   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [AI提案: この経験、コンテンツに使えそうじゃない？]     │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 7.2.10 コンテンツ生成画面 (/content/generate)

**レイアウト**:
```
┌─────────────────────────────────────────────────────────┐
│ [Actory] [録音] [ホーム] [AIチャット] [カレンダー] [プロジェクト] [ユーザー] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  コンテンツを生成                                        │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [Actoryロゴ]                                      │   │
│  │ 最近の議事録から、以下のコンテンツを生成できます:  │   │
│  │                                                   │   │
│  │ • Note記事: 「事業売却の経験談」                  │   │
│  │ • X投稿: 「スタートアップの売却プロセス」          │   │
│  │ • YouTube台本: 「事業売却の全記録」               │   │
│  │                                                   │   │
│  │ どのコンテンツを作成しますか？                    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [Note] [X] [YouTube] [Instagram] [メルマガ]            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 7.3 コンポーネント一覧

| コンポーネント名 | ファイル | 説明 |
|------------------|----------|------|
| DashboardLayout | DashboardLayout.tsx | ダッシュボードレイアウト（サイドバー、ヘッダー） |
| DashboardLayoutSkeleton | DashboardLayoutSkeleton.tsx | ダッシュボードのローディングスケルトン |
| SplashScreen | SplashScreen.tsx | スプラッシュスクリーン（ロゴフェードイン） |
| RecordingIndicator | RecordingIndicator.tsx | 録音中インジケーター |
| TaskEditDialog | TaskEditDialog.tsx | タスク編集ダイアログ |
| AIChatBox | AIChatBox.tsx | AIチャットボックス |
| ErrorBoundary | ErrorBoundary.tsx | エラーバウンダリ |
| ManusDialog | ManusDialog.tsx | 汎用ダイアログ |
| Map | Map.tsx | Google Maps統合 |
| FolderTree | FolderTree.tsx | フォルダ階層構造表示 |
| LinkGraph | LinkGraph.tsx | Obsidian風リンクグラフ |
| ContextManager | ContextManager.tsx | コンテキスト管理UI |
| OnboardingWizard | OnboardingWizard.tsx | オンボーディングウィザード |
| IntegrationSettings | IntegrationSettings.tsx | 外部サービス連携設定 |
| ContentGenerator | ContentGenerator.tsx | コンテンツ生成UI |
| TextImporter | TextImporter.tsx | テキスト一括インポート |
| ToneManager | ToneManager.tsx | 口調管理UI |

### 7.4 コンテキスト一覧

| コンテキスト名 | ファイル | 説明 |
|----------------|----------|------|
| RecordingContext | RecordingContext.tsx | グローバル録音状態管理 |
| ThemeContext | ThemeContext.tsx | テーマ（ダーク/ライト）管理 |

---

## 8. API設計

### 8.1 tRPC Router構成

```typescript
appRouter = {
  system: systemRouter,      // システム関連
  auth: authRouter,          // 認証関連
  project: projectRouter,    // プロジェクト関連
  recording: recordingRouter,// 録音関連
  taskCandidate: taskCandidateRouter, // タスク候補関連
  task: taskRouter,          // タスク関連
  file: fileRouter,          // ファイル関連
  meetingNote: meetingNoteRouter, // 議事録関連
  ai: aiRouter,              // AIチャット関連
}
```

### 8.2 API詳細

#### 8.2.1 認証API (auth)

| プロシージャ | 種別 | 説明 |
|--------------|------|------|
| auth.me | query | 現在のユーザー情報を取得 |
| auth.logout | mutation | ログアウト |

#### 8.2.2 プロジェクトAPI (project)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| project.list | query | - | プロジェクト一覧を取得 |
| project.get | query | { id: number } | プロジェクト詳細を取得 |
| project.create | mutation | { name, description?, color? } | プロジェクトを作成 |
| project.update | mutation | { id, name?, description?, color?, isArchived? } | プロジェクトを更新 |

#### 8.2.3 録音API (recording)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| recording.list | query | - | 録音一覧を取得 |
| recording.get | query | { id: number } | 録音詳細を取得 |
| recording.upload | mutation | { audioBase64, mimeType, duration? } | 録音をアップロード |
| recording.transcribe | mutation | { recordingId: number } | 文字起こしを実行 |
| recording.process | mutation | { recordingId: number } | AI処理を実行 |

#### 8.2.4 タスク候補API (taskCandidate)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| taskCandidate.pending | query | - | 承認待ちタスク候補を取得 |
| taskCandidate.byRecording | query | { recordingId: number } | 録音別タスク候補を取得 |
| taskCandidate.approve | mutation | { id, projectId?, dueDate? } | タスク候補を承認 |
| taskCandidate.reject | mutation | { id: number } | タスク候補を却下 |
| taskCandidate.bulkDecide | mutation | { decisions: [...] } | 一括承認/却下 |

#### 8.2.5 タスクAPI (task)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| task.list | query | - | タスク一覧を取得 |
| task.byProject | query | { projectId: number } | プロジェクト別タスクを取得 |
| task.get | query | { id: number } | タスク詳細を取得 |
| task.create | mutation | { title, description?, projectId?, ... } | タスクを作成 |
| task.update | mutation | { id, title?, description?, status?, ... } | タスクを更新 |
| task.inRange | query | { start, end } | 期間内のタスクを取得 |

#### 8.2.6 ファイルAPI (file)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| file.byProject | query | { projectId: number } | プロジェクト別ファイルを取得 |
| file.get | query | { id: number } | ファイル詳細を取得 |
| file.create | mutation | { projectId, name, fileType?, ... } | ファイルを作成 |
| file.update | mutation | { id, name?, description? } | ファイルを更新 |

#### 8.2.7 議事録API (meetingNote)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| meetingNote.byFile | query | { fileId: number } | ファイル別議事録を取得 |
| meetingNote.byProject | query | { projectId: number } | プロジェクト別議事録を取得 |
| meetingNote.get | query | { id: number } | 議事録詳細を取得 |
| meetingNote.recent | query | { limit?: number } | 最近の議事録を取得 |
| meetingNote.generateMinutes | mutation | { id: number } | 議事録を再生成 |
| meetingNote.generateShareToken | mutation | { id: number } | 共有トークンを生成 |
| meetingNote.getByShareToken | query | { token: string } | 共有トークンで議事録を取得（公開） |

#### 8.2.8 AIチャットAPI (ai)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| ai.knowledge | query | - | RAG用ナレッジを取得 |
| ai.searchKnowledge | query | { query: string } | ナレッジを検索 |
| ai.chat | mutation | { message, conversationId? } | AIチャットを実行 |
| ai.conversations | query | - | 会話一覧を取得 |
| ai.getMessages | query | { conversationId: number } | 会話メッセージを取得 |
| ai.deleteConversation | mutation | { conversationId: number } | 会話を削除 |

#### 8.2.9 フォルダ管理API (folder)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| folder.generateStructure | mutation | { projectId, context } | AIが階層構造を自動生成 |
| folder.suggestLocation | query | { projectId, content } | コンテンツの配置場所を提案 |
| folder.move | mutation | { fileId, targetFolderId } | ファイルを移動 |
| folder.getTree | query | { projectId } | フォルダ階層構造を取得 |

#### 8.2.10 権限管理API (permission)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| permission.list | query | { fileId } | フォルダの権限一覧を取得 |
| permission.create | mutation | { fileId, userId, permission, googleAccountId? } | 権限を設定 |
| permission.update | mutation | { id, permission } | 権限を更新 |
| permission.delete | mutation | { id } | 権限を削除 |

#### 8.2.11 リンク管理API (link)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| link.detect | mutation | { fileId } | ファイル間のリンクを自動検出 |
| link.list | query | { fileId } | ファイルのリンク一覧を取得 |
| link.create | mutation | { sourceFileId, targetFileId, linkType? } | リンクを作成 |
| link.delete | mutation | { id } | リンクを削除 |
| link.getGraph | query | { projectId } | プロジェクトのリンクグラフを取得 |

#### 8.2.12 コンテキスト管理API (context)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| context.startSession | mutation | { targetFileIds? } | コンテキスト管理セッションを開始 |
| context.askQuestion | mutation | { sessionId } | AIが質問を生成 |
| context.answer | mutation | { sessionId, answer } | ユーザーが回答 |
| context.updateStructure | mutation | { sessionId, updates } | 階層構造を更新 |
| context.getSession | query | { sessionId } | セッション情報を取得 |

#### 8.2.13 外部連携API (integration)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| integration.list | query | - | 連携一覧を取得 |
| integration.connect | mutation | { serviceType, config } | 外部サービスを連携 |
| integration.disconnect | mutation | { id } | 連携を解除 |
| integration.sync | mutation | { id } | データを同期 |
| integration.import | mutation | { id, options } | データをインポート |

#### 8.2.14 コンテンツ生成API (content)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| content.suggest | query | { projectId? } | 生成可能なコンテンツを提案 |
| content.generate | mutation | { contentType, sourceFileIds, options } | コンテンツを生成 |
| content.list | query | { projectId? } | 生成済みコンテンツ一覧を取得 |
| content.update | mutation | { id, content, status? } | コンテンツを更新 |
| content.publish | mutation | { id } | コンテンツを公開 |

#### 8.2.15 口調管理API (tone)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| tone.list | query | - | 関係性プロフィール一覧を取得 |
| tone.create | mutation | { contactName, relationshipType, tone? } | 関係性プロフィールを作成 |
| tone.update | mutation | { id, relationshipType?, tone? } | 関係性プロフィールを更新 |
| tone.learn | mutation | { contactId, message, response } | 口調を学習 |
| tone.generateReply | mutation | { contactId, message, context? } | 適切な口調で返信を生成 |

#### 8.2.16 オンボーディングAPI (onboarding)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| onboarding.start | mutation | { planType } | オンボーディングを開始 |
| onboarding.saveBusiness | mutation | { businessCount, businessNames } | 事業情報を保存 |
| onboarding.saveDepartments | mutation | { departmentCounts, departmentNames } | 部情報を保存 |
| onboarding.savePurpose | mutation | { mainPurpose } | 主な用途を保存 |
| onboarding.complete | mutation | - | オンボーディングを完了 |
| onboarding.getStatus | query | - | オンボーディングの進捗を取得 |

#### 8.2.17 テキストインポートAPI (import)

| プロシージャ | 種別 | 入力 | 説明 |
|--------------|------|------|------|
| import.text | mutation | { text, contentType, options? } | テキストをインポート |
| import.batch | mutation | { files, options? } | 複数ファイルを一括インポート |
| import.status | query | { jobId } | インポートジョブの進捗を取得 |
| import.classify | mutation | { content } | コンテンツの分類を提案 |

---

## 9. AI機能詳細

### 9.1 音声文字起こし

#### 9.1.1 使用API優先順位

1. **OpenAI Whisper API** (最優先)
   - 高精度な日本語文字起こし
   - 25MB制限あり（超過時は自動分割）

2. **Gemini API** (フォールバック1)
   - マルチモーダル対応
   - 大容量ファイル対応

3. **Aqua Voice API** (フォールバック2)
   - リアルタイム文字起こし対応
   - 日本語特化

#### 9.1.2 大容量ファイル処理

```typescript
// 25MB以上のファイルを5分ごとに分割
const splitResult = await splitAudioFile(audioBuffer, mimeType);

// 各チャンクを文字起こし
const transcriptions: string[] = [];
for (const chunk of splitResult.chunks) {
  const result = await transcribeWithOpenAI(chunk, filename, {
    language: "ja",
    prompt: "日本語の音声を文字起こししてください。",
  });
  transcriptions.push(result.text);
}

// 結果を統合
const finalTranscription = mergeTranscriptions(transcriptions);
```

### 9.2 議事録生成

#### 9.2.1 システムプロンプト

```
あなたは実務・プロダクト利用を前提とした、プロフェッショナルな議事録生成AIです。
会議後すぐに共有・保存・再利用できる品質を保ちつつ、
情報を一切取りこぼさず、かつ人が読みやすい議事録を作成してください。

基本方針:
- 情報は省略しない
- ただし無意味な冗長さは作らない
- 「短くする」ことを目的にせず、構造化によって結果的に読みやすくする
- 後から第三者が読んでも何が話され、何が決まり、次に何をすべきかが完全に理解できる状態を目指す

出力ルール:
- 推測・補完・解釈の追加は禁止（事実ベースのみ）
- 会議の時系列・論理展開を維持
- 「短さ」よりも構造と可読性を優先
- 要素の欠落がないことを最重要視
- ビジネス文書としてそのまま提出・共有できる文体で記載
```

#### 9.2.2 出力フォーマット

```json
{
  "formattedMinutes": "Markdown形式の議事録全文",
  "agendaItems": ["議題1", "議題2"],
  "discussionDetails": "Markdown形式の詳細な議論内容",
  "nextMeeting": "次回会議の情報（日時など）",
  "additionalNotes": "追加メモ・補足情報"
}
```

### 9.3 タスク抽出

#### 9.3.1 タスク名生成ルール

```
タスク名の生成ルール:
- 抽象的なタスク名は禁止
  ❌ 「SNS投稿を作る」
  ❌ 「投稿スケジュールの確定」
  ❌ 「資料を準備する」

- 具体的で一目で何をすればいいかわかるタスク名にする
  ✅ 「Instagram用の商品紹介画像3枚を作成する」
  ✅ 「来週月曜日の投稿内容を決定し、担当者にSlackで通知する」
  ✅ 「クライアントA社向け提案書のスライド10枚を作成する」

- 動詞で終わる形式
- 成果物が明確
- 期限や数量を含める（可能な場合）
```

#### 9.3.2 Function Calling定義

```typescript
const tools = [
  {
    type: "function",
    function: {
      name: "create_task",
      description: "ユーザーの要望に基づいてタスクを作成します",
      parameters: {
        type: "object",
        properties: {
          title: {
            type: "string",
            description: "具体的で一目で何をすればいいかわかるタスク名"
          },
          description: {
            type: "string",
            description: "タスクの詳細説明"
          },
          dueDate: {
            type: "string",
            description: "期限（ISO 8601形式）"
          },
          priority: {
            type: "string",
            enum: ["low", "medium", "high"],
            description: "優先度"
          },
          projectId: {
            type: "number",
            description: "プロジェクトID"
          }
        },
        required: ["title", "description"]
      }
    }
  }
];
```

### 9.4 RAGナレッジ検索

#### 9.4.1 スコアリングアルゴリズム

```typescript
// ストップワードを除外
const stopWords = new Set([
  'って', 'とは', 'について', 'を', 'の', 'に', 'が', 'で', 'と',
  '教えて', '知りたい', 'ある', 'いる', 'する', 'なる', 'できる',
  // ...
]);

// キーワードを抽出（ストップワードを除外、最低2文字以上）
const queryKeywords = userQuery
  .split(/[\s　、。，．？！]+/)
  .filter(k => k.length >= 2 && !stopWords.has(k));

// メインキーワード（3文字以上）とサブキーワード（2文字）を分離
const mainKeywords = queryKeywords.filter(k => k.length >= 3);
const subKeywords = queryKeywords.filter(k => k.length === 2);

// スコアリング
for (const source of allKnowledgeSources) {
  let score = 0;
  let mainKeywordMatches = 0;
  
  for (const keyword of mainKeywords) {
    if (titleLower.includes(keyword)) {
      score += 50; // タイトルマッチは高得点
      mainKeywordMatches++;
    } else if (projectNameLower.includes(keyword)) {
      score += 40; // プロジェクト名マッチ
      mainKeywordMatches++;
    } else if (excerptLower.includes(keyword)) {
      score += 20; // 要約マッチ
      mainKeywordMatches++;
    } else if (fullContentLower.includes(keyword)) {
      score += 10; // 全文マッチ
      mainKeywordMatches++;
    }
  }
  
  // メインキーワードが1つもマッチしない場合はスコア0
  if (mainKeywords.length > 0 && mainKeywordMatches === 0) {
    score = 0;
  }
}

// 最高スコアの50%以上のスコアを持つナレッジのみを選択
// 最大3件に制限
```

---

## 10. UI/UXデザイン仕様

### 10.1 カラーパレット

| 名前 | HEX | 用途 |
|------|-----|------|
| Primary | #00D4AA | メインアクセントカラー |
| Primary Foreground | #0a0f0f | プライマリ上のテキスト |
| Secondary | #0D7377 | セカンダリアクセント |
| Background | #0a0f0f | 背景色 |
| Foreground | #e0f2f1 | テキスト色 |
| Card | #0d1a1a | カード背景 |
| Card Foreground | #e0f2f1 | カード上のテキスト |
| Border | #1a3333 | ボーダー色 |
| Muted | #1a2f2f | ミュートカラー |
| Muted Foreground | #80a0a0 | ミュートテキスト |
| Accent | #10B981 | アクセントカラー |
| Destructive | #ef4444 | 警告・削除 |

### 10.2 タイポグラフィ

| 要素 | フォント | サイズ | ウェイト |
|------|----------|--------|----------|
| 見出し1 | システムフォント | 2rem | 700 |
| 見出し2 | システムフォント | 1.5rem | 600 |
| 見出し3 | システムフォント | 1.25rem | 600 |
| 本文 | システムフォント | 1rem | 400 |
| 小テキスト | システムフォント | 0.875rem | 400 |
| キャプション | システムフォント | 0.75rem | 400 |

### 10.3 アニメーション

#### 10.3.1 背景グラデーションアニメーション

```css
@keyframes gradientShift {
  0%, 100% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
}

.animated-background {
  background: linear-gradient(
    135deg,
    #0a0f0f 0%,
    #0d1a1a 25%,
    #1a2f2f 50%,
    #0d1a1a 75%,
    #0a0f0f 100%
  );
  background-size: 400% 400%;
  animation: gradientShift 15s ease infinite;
}
```

#### 10.3.2 録音ボタンアニメーション

```css
@keyframes pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

.recording-button {
  animation: pulse 2s ease-in-out infinite;
}

/* 音量に応じたスケール変化 */
.recording-button.active {
  transform: scale(calc(1 + var(--volume) * 0.2));
  transition: transform 0.1s ease;
}
```

#### 10.3.3 音声波形アニメーション

```css
@keyframes wave {
  0%, 100% {
    height: 4px;
  }
  50% {
    height: calc(4px + var(--volume) * 20px);
  }
}

.waveform-bar {
  animation: wave 0.5s ease-in-out infinite;
  animation-delay: calc(var(--index) * 0.1s);
}
```

### 10.4 レスポンシブデザイン

| ブレークポイント | 幅 | 説明 |
|------------------|-----|------|
| Mobile | < 640px | モバイル表示 |
| Tablet | 640px - 1024px | タブレット表示 |
| Desktop | > 1024px | デスクトップ表示 |

**モバイル対応**:
- ナビゲーションは下部に固定
- カレンダーは全幅表示
- タスク一覧は下部に配置
- 録音ボタンは中央に大きく表示

**デスクトップ対応**:
- ナビゲーションは上部に横並び
- カレンダーは左側、タスク一覧は右側
- サイドバーレイアウト対応

---

## 11. 非機能要件

### 11.1 パフォーマンス要件

| 項目 | 要件 |
|------|------|
| 初期ロード時間 | 3秒以内 |
| API応答時間 | 500ms以内（文字起こし除く） |
| 文字起こし処理 | 音声長の2倍以内 |
| 議事録生成 | 30秒以内 |
| 同時接続数 | 100ユーザー以上 |

### 11.2 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 認証 | Manus OAuth |
| データ分離 | ユーザーごとに完全分離 |
| 通信 | HTTPS必須 |
| セッション | JWT + HttpOnly Cookie |
| ファイルアクセス | 署名付きURL |

### 11.3 可用性要件

| 項目 | 要件 |
|------|------|
| 稼働率 | 99.5%以上 |
| バックアップ | 日次 |
| 障害復旧 | 4時間以内 |

### 11.4 スケーラビリティ要件

| 項目 | 要件 |
|------|------|
| ユーザー数 | 10,000ユーザーまで対応 |
| ストレージ | 自動スケーリング |
| データベース | 水平スケーリング対応 |

---

## 12. 開発履歴

### 12.1 開発フェーズ

| フェーズ | 期間 | 主な実装内容 |
|----------|------|--------------|
| Phase 1 | 12/19 | コア機能（録音、文字起こし、タスク生成） |
| Phase 2 | 12/19 | UI/UXリデザイン（Actoryスタイル） |
| Phase 3 | 12/19 | 録音UX改善（Apple風デザイン） |
| Phase 4 | 12/19 | ダークスタイリッシュテーマ |
| Phase 5 | 12/19 | 議事録管理機能 |
| Phase 6 | 12/19 | AIチャット・RAG機能 |
| Phase 7 | 12/20 | 会話履歴・共有機能 |
| Phase 8 | 12/20 | RAG精度向上・タスク作成機能 |
| Phase 9 | 12/21 | 大容量ファイル対応・UI改善 |

### 12.2 主要な変更履歴

#### 12/19 - 初期リリース
- ワンタップ音声録音機能
- AI音声文字起こし機能（Whisper API）
- AIタスク自動生成機能
- タスク確認画面（Yes/Noトグル）
- プロジェクト管理機能
- Apple Calendar風カレンダー表示
- タスク編集機能
- 自動リマインダー設定
- 自動通知機能

#### 12/19 - UI/UXリデザイン
- Actoryロゴ導入
- シアン〜ブルーのグラデーションカラーパレット
- スプラッシュスクリーン実装
- ホーム画面刷新
- 録音画面UI改善
- カレンダー画面UI改善
- プロジェクト画面UI改善

#### 12/19 - 録音UX改善
- グラデーション背景の常時アニメーション
- 音声波形の可視化
- スワイプ/タップで録音開始
- 超ミニマルなApple風デザイン
- 録音ボタンのシンプル化

#### 12/19 - 議事録機能強化
- filesテーブル追加（階層構造）
- meetingNotesテーブル追加
- AIによる自動ファイル配置
- 議事録の自動生成
- プロフェッショナルな議事録フォーマット

#### 12/19 - AIチャット機能
- RAGナレッジ検索
- AIチャット会話
- ナレッジ参照トグル
- 議事録への直接遷移

#### 12/20 - 会話履歴・共有機能
- 会話履歴の保存
- 会話の引き継ぎ
- 議事録共有機能
- 共有ページにActoryロゴと導線

#### 12/20 - RAG精度向上
- メインキーワードマッチング強化
- ストップワード除外
- 閾値フィルタリング
- 最大3件に制限

#### 12/20 - AIチャットからタスク作成
- Function Callingでタスク作成
- 緑色のカードで通知
- カレンダーに即座に反映

#### 12/21 - 大容量ファイル対応
- 50MBまでのファイルインポート対応
- FFmpegによる音声分割
- 分割文字起こし結果の統合

#### 12/21 - UI改善
- プログレスバー表示
- 録音のバックグラウンド継続
- 具体的なタスク名生成
- ホームにプロジェクト名表示
- カレンダーにタスク説明文追加

---

## 13. 今後の拡張計画

### 13.1 短期計画（1-3ヶ月）

| 機能 | 説明 | 優先度 |
|------|------|--------|
| AI自動フォルダ管理 | AIがコンテキストを自動分割し、階層構造を自動生成 | 高 |
| オンボーディング機能 | 初回ログイン時に事業構造を聞いて自動でフォルダ階層構造を生成 | 高 |
| コンテキスト管理機能 | AIが質問してコンテキストを整理し、ユーザーの第二の脳となる | 高 |
| タスク優先度変更 | AIチャットで「このタスクを高優先度にして」と言って変更 | 高 |
| プロジェクトアーカイブ | 完了したプロジェクトを非表示にする機能 | 高 |
| 録音時のプロジェクト選択 | 録音時にプロジェクトと階層構造を選択 | 中 |
| 会話履歴削除 | AIチャットで不要な会話を削除 | 中 |
| リマインダー通知 | タスク期限が近づいたらプッシュ通知 | 中 |
| 音声ファイル圧縮 | アップロード前にクライアント側で圧縮 | 低 |

### 13.2 中期計画（3-6ヶ月）

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 組織共有機能 | フォルダ階層構造にGoogleアカウントの認証権限を付与 | 高 |
| 外部サービス連携 | Gmail, Notion, Google Calendar, Obsidian, Evernote, LINE, Slack, Discordなど | 高 |
| テキストインポート機能 | 大量のテキストをインポートして自動整理 | 高 |
| Obsidian風リンク機能 | ファイル間の関連性を自動検出し、リンクで繋がりを可視化 | 高 |
| 視覚的な階層構造表示 | 全体の階層構造をリンクで見やすく表示 | 高 |
| チーム機能 | 複数ユーザーでプロジェクトを共有 | 高 |
| カレンダー同期 | Google Calendar/Apple Calendarとの同期 | 高 |
| 口調管理機能 | 相手との関係性に応じた口調を管理 | 中 |
| コンテンツ生成機能 | Note, X, YouTube, Instagram, メルマガなどのコンテンツを生成 | 中 |
| 音声検索 | 音声でナレッジを検索 | 中 |
| 議事録テンプレート | カスタム議事録フォーマット | 中 |
| モバイルアプリ | iOS/Androidネイティブアプリ（毎日自動録音機能含む） | 高 |
| メール・返信生成機能 | 過去のコンテキストを踏まえてメールや返信を自動生成 | 中 |

### 13.3 長期計画（6-12ヶ月）

| 機能 | 説明 | 優先度 |
|------|------|--------|
| AI議事録要約 | 複数議事録を横断した要約生成 | 高 |
| プロジェクトごとの立場理解 | AIがプロジェクトごとのユーザーの立場を理解 | 高 |
| 過去データ一括インポート | 初回セットアップ時に過去のデータを一括インポート | 高 |
| Notion風UI | カスタマイズ可能なNotion風のデザイン | 中 |
| コンテキストエンジニアリング | コンテキストエンジニアリングにも使いやすい機能 | 中 |
| 自動アクション | タスク完了時の自動アクション | 中 |
| API公開 | 外部サービス連携用API | 中 |
| エンタープライズ機能 | SSO、監査ログ、権限管理 | 低 |
| リアルタイム文字起こし | 会議中のリアルタイム文字起こし | 中 |
| 話者識別 | 会議参加者の自動識別 | 中 |

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| RAG | Retrieval-Augmented Generation。検索拡張生成。外部知識を検索してLLMに提供する手法 |
| tRPC | TypeScript Remote Procedure Call。型安全なAPIを構築するためのフレームワーク |
| Drizzle ORM | TypeScript用の軽量ORMライブラリ |
| Whisper | OpenAIの音声認識モデル |
| Function Calling | LLMに外部関数を呼び出させる機能 |
| コンテキスト管理AI | AIがユーザーの第二の脳となり、コンテキストを理解・整理・提案する機能 |
| Obsidian風リンク | ファイル間の関連性を自動検出し、リンクで繋がりを可視化する機能 |
| 階層構造自動生成 | AIがコンテキストを自動分割し、フォルダの階層構造を自動生成・管理する機能 |
| 口調管理 | 相手との関係性に応じた口調を学習・管理し、適切な返信を生成する機能 |
| コンテンツ生成 | 蓄積されたナレッジからNote、X、YouTube、Instagram、メルマガなどのコンテンツを生成する機能 |

### B. 参考リンク

- [OpenAI Whisper API](https://platform.openai.com/docs/guides/speech-to-text)
- [OpenAI Function Calling](https://platform.openai.com/docs/guides/function-calling)
- [tRPC Documentation](https://trpc.io/docs)
- [Drizzle ORM Documentation](https://orm.drizzle.team/docs/overview)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)

---

**文書終了**

*本要件定義書は、Actory - 行動直結型ナレッジOSの完全な仕様を記載したものです。すべての機能、画面、API、データベース設計、UI/UXデザイン仕様が網羅されています。*


---

## 4. 機能要件詳細

### 4.1 音声録音機能

#### 4.1.1 基本録音機能

**機能概要:**
ユーザーがスマートフォンやPCのマイクを使用して音声を録音し、その音声を自動的に文字起こしして議事録として保存する機能。

**詳細仕様:**

| 項目 | 仕様 |
|------|------|
| 録音形式 | WebM (Opus codec) |
| サンプリングレート | 48kHz |
| 最大録音時間 | 無制限（ストレージ容量に依存） |
| 最大ファイルサイズ | 50MB |
| 対応ブラウザ | Chrome, Safari, Firefox, Edge |

**録音フロー:**
1. ユーザーが録音画面にアクセス
2. プロジェクトを選択（必須）
3. 「タップして録音開始」ボタンをタップ
4. マイクアクセス許可を要求（初回のみ）
5. 録音開始（波形アニメーション表示）
6. 録音中は経過時間を表示
7. 停止ボタンをタップで録音終了
8. 自動的に文字起こし処理を開始
9. 議事録生成後、プロジェクト詳細画面に遷移

**バックグラウンド録音機能:**
- 録音中に他のページに移動しても録音が継続
- グローバルなRecordingContextで状態管理
- 画面上部に録音中インジケーターを表示
- インジケーターをタップで録音画面に戻る

**UI仕様:**
- Actoryロゴを中央に配置
- 録音ボタンは大きな円形（タップしやすいサイズ）
- 録音中は赤い波形アニメーションを表示
- 経過時間は「MM:SS」形式で表示
- シンプルでスタイリッシュなデザイン

#### 4.1.2 音声ファイルインポート機能

**機能概要:**
既存の音声ファイルをアップロードして文字起こしし、議事録として保存する機能。

**対応フォーマット:**
- MP3
- WAV
- M4A
- WebM
- OGG

**ファイルサイズ制限:**
- 最大50MB
- 25MB以上のファイルは自動的に分割処理

**大容量ファイル処理:**
1. 25MB以上のファイルを検出
2. ffmpegで5分ごとのチャンクに分割
3. 各チャンクをWhisper APIで文字起こし
4. 結果を統合して1つの議事録として保存

**プログレスバー表示:**
- ファイルアップロード中にプログレスバーを表示
- 処理段階に応じたメッセージ表示
  - 「音声ファイルをアップロード中...」
  - 「音声を文字起こし中...」
  - 「議事録を生成中...」
- シンプルでスタイリッシュなデザイン

### 4.2 文字起こし機能

#### 4.2.1 Whisper API連携

**使用API:** OpenAI Whisper API

**処理フロー:**
1. 音声ファイルをS3にアップロード
2. Whisper APIに音声URLを送信
3. 文字起こし結果を取得
4. LLMで議事録形式に整形

**言語対応:**
- 日本語（メイン）
- 英語
- その他Whisperがサポートする言語

**精度向上施策:**
- 音声品質に応じた前処理
- ノイズ除去（将来実装予定）

#### 4.2.2 議事録生成

**生成内容:**
- タイトル（自動生成）
- 要約（3-5文程度）
- 詳細内容（話された内容を整理）
- タスク抽出（具体的なアクションアイテム）

**タスク抽出仕様:**
- 具体的で実行可能なタスク名を生成
- 抽象的なタスク名は避ける
- 例：「SNS投稿を作る」→「Instagram用の商品紹介投稿を3件作成する」
- 期限が言及されていれば自動設定
- 優先度は内容に応じて自動判定

### 4.3 プロジェクト管理機能

#### 4.3.1 プロジェクトCRUD

**作成機能:**
- プロジェクト名（必須）
- 説明文（任意）
- 作成日時は自動設定

**一覧表示:**
- カード形式で表示
- プロジェクト名、説明、作成日時を表示
- 議事録数を表示
- タップでプロジェクト詳細に遷移

**編集機能:**
- プロジェクト名の変更
- 説明文の変更

**削除機能:**
- 確認ダイアログを表示
- 関連する議事録、タスク、ナレッジも削除

#### 4.3.2 プロジェクト詳細画面

**表示内容:**
- プロジェクト名
- 説明文
- 議事録一覧（日付順）
- タスク一覧

**議事録一覧:**
- 日付でグループ化
- タイトル、要約を表示
- タップでモーダル表示

**議事録モーダル:**
- タイトル
- 要約
- 詳細内容
- 抽出されたタスク
- 共有ボタン
- 編集ボタン
- 削除ボタン

### 4.4 タスク管理機能

#### 4.4.1 タスクCRUD

**作成機能:**
- タスク名（必須、具体的な内容）
- 説明文（任意）
- 期限（任意）
- 優先度（高/中/低）
- プロジェクト紐付け（必須）
- 議事録紐付け（任意）

**一覧表示:**
- カレンダー画面で表示
- 日付ごとにグループ化
- 優先度に応じた色分け
- 完了/未完了のステータス表示

**編集機能:**
- すべての項目を編集可能
- インライン編集対応

**削除機能:**
- 確認ダイアログを表示

#### 4.4.2 タスク表示仕様

**カレンダー表示:**
- 日付セルにタスク数を丸で表示
- 日付をタップでその日のタスク一覧を表示
- タスク名の横に説明文を小さく表示

**ホーム画面表示:**
- 「今後の予定」セクションに表示
- プロジェクト名をバッジで表示
- 期限、優先度を表示

**優先度表示:**
- 高: 赤色
- 中: 黄色
- 低: 緑色

### 4.5 AIチャット機能

#### 4.5.1 基本チャット機能

**機能概要:**
ユーザーが自然言語で質問し、蓄積されたナレッジを参照してAIが回答する機能。

**UI仕様:**
- 入力欄は画面の一番下に固定配置
- メッセージは上から下に時系列で表示
- AIの回答にはナレッジ参照トグルを表示
- ストリーミング表示対応

#### 4.5.2 RAG（Retrieval-Augmented Generation）

**検索ロジック:**
1. ユーザーの質問からキーワードを抽出
2. ストップワードを除外（「について」「とは」「教えて」など）
3. 3文字以上のメインキーワードを抽出
4. ナレッジベースを検索
5. スコアリングでランキング
6. 閾値（最高スコアの50%以上）でフィルタリング
7. 最大3件を参照

**スコアリング基準:**
- タイトルマッチ: 高スコア
- 要約マッチ: 中スコア
- 詳細内容マッチ: 低スコア
- メインキーワードマッチ: ボーナススコア

**参照表示:**
- 「N件のナレッジを参照」トグル
- 展開すると参照元の詳細を表示
- プロジェクト名 > ファイル名 > 議事録タイトルの階層表示
- 引用箇所のテキスト抜粋
- 「議事録を見る」ボタンで直接遷移

#### 4.5.3 会話履歴機能

**保存内容:**
- 会話ID
- タイトル（自動生成）
- メッセージ履歴
- 参照ナレッジ情報
- 作成日時

**履歴表示:**
- サイドパネルに履歴一覧を表示
- タップで過去の会話を復元
- メッセージと参照ナレッジが正しく復元

**履歴引き継ぎ:**
- 過去の会話をタップするとメッセージが復元
- sourcesフィールドを正しくパース
- APIフォーマット: `{ json: { conversationId } }`
- レスポンスパス: `data.result.data.json`

#### 4.5.4 タスク作成機能

**機能概要:**
AIチャットからシームレスにタスクを作成できる機能。

**実装方式:**
- OpenAI Function Callingを使用
- create_taskツールを定義
- AIが自動的にタスク作成を判断

**タスク作成フロー:**
1. ユーザーが「タスクを追加して」などと発言
2. AIがFunction Callingでタスク作成を実行
3. データベースにタスクを保存
4. 緑色のカードでタスク作成を通知
5. 「確認」ボタンでカレンダーに遷移

**タスク名生成ルール:**
- 具体的で実行可能な内容
- 抽象的な表現は避ける
- 何をすればいいか一目でわかる

### 4.6 共有機能

#### 4.6.1 共有リンク生成

**機能概要:**
議事録を誰でも閲覧できる公開ページとして共有する機能。

**共有フロー:**
1. 議事録モーダルで「共有」ボタンをタップ
2. 共有リンクを生成
3. クリップボードにコピー
4. トースト通知で完了を表示

**共有URL形式:**
`/share/{shareId}`

#### 4.6.2 共有ページ

**表示内容:**
- Actoryロゴとブランディング
- 議事録タイトル
- 要約
- 詳細内容
- 抽出されたタスク
- 「Actoryで議事録を作成する」CTA

**デザイン:**
- ヘッダーにActoryロゴ
- フッターに「Powered by Actory」
- シンプルで読みやすいレイアウト
- レスポンシブ対応

### 4.7 ホーム画面

#### 4.7.1 ダッシュボード表示

**表示セクション:**
1. ウェルカムメッセージ
2. クイックアクション（録音、インポート、チャット）
3. 今後の予定（タスク一覧）
4. 最近の議事録

**今後の予定:**
- 期限が近いタスクを表示
- プロジェクト名をバッジで表示
- 優先度に応じた色分け
- タップでタスク詳細を表示

**最近の議事録:**
- 最新の議事録を5件表示
- タイトル、プロジェクト名、日時を表示
- タップで議事録詳細を表示

### 4.8 カレンダー機能

#### 4.8.1 カレンダー表示

**表示形式:**
- 月間カレンダー
- 日付セルにタスク数を丸で表示
- 今日の日付をハイライト

**インタラクション:**
- 日付をタップでその日のタスク一覧を表示
- 左右スワイプで月を切り替え
- 「今日」ボタンで今日に戻る

#### 4.8.2 タスク一覧表示

**選択日のタスク:**
- 「N月N日 (曜日)のタスク (N件)」ヘッダー
- タスク名、説明文、優先度を表示
- 完了チェックボックス

**すべてのタスク:**
- 全タスクを日付順で表示
- タスク名の横に説明文を小さく表示
- プロジェクト名をバッジで表示

---

## 5. 非機能要件

### 5.1 パフォーマンス要件

| 項目 | 目標値 |
|------|--------|
| ページ読み込み時間 | 3秒以内 |
| API応答時間 | 500ms以内（文字起こし除く） |
| 文字起こし処理時間 | 音声長の2倍以内 |
| 同時接続ユーザー数 | 100ユーザー |

### 5.2 セキュリティ要件

**認証:**
- Manus OAuth認証
- JWTセッション管理
- セッションタイムアウト: 7日

**データ保護:**
- HTTPS通信必須
- S3ファイルはプライベートアクセス
- ユーザーデータの分離

### 5.3 可用性要件

| 項目 | 目標値 |
|------|--------|
| 稼働率 | 99.5% |
| 計画停止時間 | 月4時間以内 |
| 障害復旧時間 | 4時間以内 |

### 5.4 スケーラビリティ要件

- 水平スケーリング対応
- データベース接続プーリング
- CDNによる静的ファイル配信

---

## 6. 技術仕様

### 6.1 システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                        Client (Browser)                      │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    React 19 + Vite                       ││
│  │  ┌───────────┐ ┌───────────┐ ┌───────────┐              ││
│  │  │   Pages   │ │Components │ │  Contexts │              ││
│  │  └───────────┘ └───────────┘ └───────────┘              ││
│  │  ┌───────────────────────────────────────┐              ││
│  │  │         tRPC Client + React Query      │              ││
│  │  └───────────────────────────────────────┘              ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     Server (Express + tRPC)                  │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    tRPC Router                           ││
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐           ││
│  │  │  auth  │ │project │ │  task  │ │   ai   │           ││
│  │  └────────┘ └────────┘ └────────┘ └────────┘           ││
│  └─────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    Core Services                         ││
│  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐           ││
│  │  │  LLM   │ │Whisper │ │Storage │ │  Auth  │           ││
│  │  └────────┘ └────────┘ └────────┘ └────────┘           ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    External Services                         │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐               │
│  │ TiDB   │ │   S3   │ │ OpenAI │ │ Manus  │               │
│  │Database│ │Storage │ │  API   │ │ OAuth  │               │
│  └────────┘ └────────┘ └────────┘ └────────┘               │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 データベーススキーマ

#### 6.2.1 usersテーブル

```sql
CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  open_id VARCHAR(255) NOT NULL UNIQUE,
  name VARCHAR(255),
  avatar VARCHAR(500),
  role ENUM('admin', 'user') DEFAULT 'user',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 6.2.2 projectsテーブル

```sql
CREATE TABLE projects (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 6.2.3 meetingFilesテーブル

```sql
CREATE TABLE meeting_files (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  user_id INT NOT NULL,
  file_name VARCHAR(255) NOT NULL,
  file_url VARCHAR(500),
  file_key VARCHAR(255),
  transcript TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 6.2.4 meetingMinutesテーブル

```sql
CREATE TABLE meeting_minutes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  meeting_file_id INT NOT NULL,
  project_id INT NOT NULL,
  user_id INT NOT NULL,
  title VARCHAR(255) NOT NULL,
  summary TEXT,
  details TEXT,
  share_id VARCHAR(255) UNIQUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (meeting_file_id) REFERENCES meeting_files(id) ON DELETE CASCADE,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 6.2.5 tasksテーブル

```sql
CREATE TABLE tasks (
  id INT AUTO_INCREMENT PRIMARY KEY,
  project_id INT NOT NULL,
  meeting_minutes_id INT,
  user_id INT NOT NULL,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  due_date DATE,
  priority ENUM('high', 'medium', 'low') DEFAULT 'medium',
  status ENUM('pending', 'completed') DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  FOREIGN KEY (meeting_minutes_id) REFERENCES meeting_minutes(id) ON DELETE SET NULL,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 6.2.6 knowledgeテーブル

```sql
CREATE TABLE knowledge (
  id INT AUTO_INCREMENT PRIMARY KEY,
  meeting_minutes_id INT NOT NULL,
  project_id INT NOT NULL,
  user_id INT NOT NULL,
  title VARCHAR(255) NOT NULL,
  summary TEXT,
  details TEXT,
  keywords TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (meeting_minutes_id) REFERENCES meeting_minutes(id) ON DELETE CASCADE,
  FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 6.2.7 chatConversationsテーブル

```sql
CREATE TABLE chat_conversations (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  title VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 6.2.8 chatMessagesテーブル

```sql
CREATE TABLE chat_messages (
  id INT AUTO_INCREMENT PRIMARY KEY,
  conversation_id INT NOT NULL,
  user_id INT NOT NULL,
  role ENUM('user', 'assistant') NOT NULL,
  content TEXT NOT NULL,
  sources TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (conversation_id) REFERENCES chat_conversations(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### 6.3 API仕様

#### 6.3.1 認証API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| auth.me | Query | 現在のユーザー情報を取得 |
| auth.logout | Mutation | ログアウト |

#### 6.3.2 プロジェクトAPI

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| project.list | Query | プロジェクト一覧を取得 |
| project.get | Query | プロジェクト詳細を取得 |
| project.create | Mutation | プロジェクトを作成 |
| project.update | Mutation | プロジェクトを更新 |
| project.delete | Mutation | プロジェクトを削除 |

#### 6.3.3 議事録API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| minutes.list | Query | 議事録一覧を取得 |
| minutes.get | Query | 議事録詳細を取得 |
| minutes.getByShareId | Query | 共有IDで議事録を取得 |
| minutes.update | Mutation | 議事録を更新 |
| minutes.delete | Mutation | 議事録を削除 |
| minutes.generateShareLink | Mutation | 共有リンクを生成 |

#### 6.3.4 タスクAPI

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| task.list | Query | タスク一覧を取得 |
| task.get | Query | タスク詳細を取得 |
| task.create | Mutation | タスクを作成 |
| task.update | Mutation | タスクを更新 |
| task.delete | Mutation | タスクを削除 |
| task.toggleStatus | Mutation | タスクの完了状態を切り替え |

#### 6.3.5 AI API

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| ai.chat | Mutation | AIチャット（RAG対応） |
| ai.getConversations | Query | 会話履歴一覧を取得 |
| ai.getMessages | Query | 会話のメッセージを取得 |
| ai.deleteConversation | Mutation | 会話を削除 |

#### 6.3.6 文字起こしAPI

| エンドポイント | メソッド | 説明 |
|---------------|---------|------|
| transcribe.process | Mutation | 音声ファイルを文字起こし |

### 6.4 フロントエンド構成

#### 6.4.1 ページ一覧

| パス | コンポーネント | 説明 |
|------|---------------|------|
| / | Home.tsx | ホーム画面 |
| /record | Record.tsx | 録音画面 |
| /import | Import.tsx | ファイルインポート画面 |
| /projects | Projects.tsx | プロジェクト一覧 |
| /projects/:id | ProjectDetail.tsx | プロジェクト詳細 |
| /calendar | Calendar.tsx | カレンダー画面 |
| /chat | AIChat.tsx | AIチャット画面 |
| /share/:shareId | SharedMinutes.tsx | 共有議事録画面 |

#### 6.4.2 コンポーネント一覧

| コンポーネント | 説明 |
|---------------|------|
| DashboardLayout.tsx | ダッシュボードレイアウト |
| DashboardLayoutSkeleton.tsx | ローディングスケルトン |
| RecordingIndicator.tsx | 録音中インジケーター |
| AIChatBox.tsx | AIチャットボックス |
| Map.tsx | Google Maps連携 |

#### 6.4.3 コンテキスト一覧

| コンテキスト | 説明 |
|-------------|------|
| AuthContext | 認証状態管理 |
| ThemeContext | テーマ管理 |
| RecordingContext | 録音状態管理 |

---

## 7. UI/UXデザイン仕様

### 7.1 デザインシステム

#### 7.1.1 カラーパレット

**プライマリカラー:**
- Primary: #3B82F6 (Blue)
- Primary Foreground: #FFFFFF

**セカンダリカラー:**
- Secondary: #6B7280 (Gray)
- Secondary Foreground: #FFFFFF

**アクセントカラー:**
- Accent: #8B5CF6 (Purple)
- Accent Foreground: #FFFFFF

**セマンティックカラー:**
- Success: #10B981 (Green)
- Warning: #F59E0B (Amber)
- Error: #EF4444 (Red)
- Info: #3B82F6 (Blue)

**優先度カラー:**
- High: #EF4444 (Red)
- Medium: #F59E0B (Amber)
- Low: #10B981 (Green)

#### 7.1.2 タイポグラフィ

**フォントファミリー:**
- Primary: Inter, system-ui, sans-serif
- Monospace: JetBrains Mono, monospace

**フォントサイズ:**
- xs: 0.75rem (12px)
- sm: 0.875rem (14px)
- base: 1rem (16px)
- lg: 1.125rem (18px)
- xl: 1.25rem (20px)
- 2xl: 1.5rem (24px)
- 3xl: 1.875rem (30px)

#### 7.1.3 スペーシング

- 1: 0.25rem (4px)
- 2: 0.5rem (8px)
- 3: 0.75rem (12px)
- 4: 1rem (16px)
- 5: 1.25rem (20px)
- 6: 1.5rem (24px)
- 8: 2rem (32px)

#### 7.1.4 ボーダー半径

- sm: 0.125rem (2px)
- md: 0.375rem (6px)
- lg: 0.5rem (8px)
- xl: 0.75rem (12px)
- 2xl: 1rem (16px)
- full: 9999px

### 7.2 コンポーネントスタイル

#### 7.2.1 ボタン

**バリアント:**
- default: プライマリカラー背景
- secondary: セカンダリカラー背景
- outline: 透明背景、ボーダーあり
- ghost: 透明背景、ホバーで背景表示
- destructive: エラーカラー背景

**サイズ:**
- sm: 高さ32px、パディング12px
- md: 高さ40px、パディング16px
- lg: 高さ48px、パディング24px

#### 7.2.2 カード

- 背景: card色
- ボーダー: 1px solid border色
- ボーダー半径: lg
- シャドウ: sm
- パディング: 16px

#### 7.2.3 入力フィールド

- 高さ: 40px
- ボーダー: 1px solid input色
- ボーダー半径: md
- フォーカス時: リング表示

### 7.3 レスポンシブデザイン

**ブレークポイント:**
- sm: 640px
- md: 768px
- lg: 1024px
- xl: 1280px
- 2xl: 1536px

**モバイルファースト:**
- 基本スタイルはモバイル向け
- 大きな画面向けにメディアクエリで拡張

---

## 8. 開発履歴

### 8.1 初期開発（12/19）

1. プロジェクト作成（knowledge-os）
2. 基本的なプロジェクト管理機能
3. 音声録音機能
4. 文字起こし機能（Whisper API）
5. 議事録生成機能（LLM）
6. タスク抽出機能

### 8.2 機能追加（12/20 追加1-10）

1. **追加1:** ホーム画面の改善
2. **追加2:** カレンダー機能
3. **追加3:** AIチャット機能（RAG）
4. **追加4:** ナレッジベース構築
5. **追加5:** 会話履歴機能
6. **追加6:** タスク管理改善
7. **追加7:** プロジェクト詳細改善
8. **追加8:** 議事録編集機能
9. **追加9:** 共有リンク機能
10. **追加10:** UI/UXブラッシュアップ

### 8.3 機能追加（12/20 追加11-16）

11. **追加11:** AIチャットと共有機能改善
    - 会話履歴の引き継ぎ
    - 入力欄を一番下に配置
    - RAGの精度向上
    - 議事録への直接遷移
    - 共有リンク機能の実装
    - 共有ページにActoryロゴと導線追加

12. **追加12:** AIチャット改善
    - RAGの精度向上（キーワードベース）
    - 入力欄を画面の一番下に固定
    - 議事録への直接遷移（モーダル表示）

13. **追加13:** AIチャットとカレンダー改善
    - RAGの精度をさらに向上（メインキーワードマッチング強化）
    - カレンダーのタスク表示機能（日付タップでタスク一覧）

14. **追加14:** AIチャットからタスク作成機能
    - Function Callingでタスク作成
    - 緑色のカードで通知
    - カレンダーへの遷移ボタン

15. **追加15:** 音声ファイルインポート上限拡張
    - 50MBまで対応
    - Import.tsxとRecord.tsxの両方を変更

16. **追加16:** 音声インポート議事録作成問題の調査と修正
    - OpenAI Whisper APIの25MB制限が原因
    - 25MB以上のファイルを分割処理
    - 分割結果を統合して1つの議事録として作成

### 8.4 機能追加（12/21 追加17-18）

17. **追加17:** UI/UX改善
    - 大きなファイルの処理中にプログレスバーを表示
    - 録音のバックグラウンド継続（RecordingContext）
    - 具体的なタスク名の生成（プロンプト改善）
    - ホームの今後の予定にプロジェクト名をバッジ表示
    - カレンダーのタスクに説明文を追加

18. **追加18:** 録音画面UI修正
    - 録音画面の見た目を前回のバージョンに戻す
    - 機能はそのまま維持
    - UI/UX改善機能を再度追加

---

## 9. 今後の拡張予定

### 9.1 短期（1-2週間）

- [ ] タスクの優先度変更機能（AIチャットから）
- [ ] プロジェクトのアーカイブ機能
- [ ] 会話履歴の削除機能
- [ ] リマインダー通知

### 9.2 中期（1-2ヶ月）

- [ ] 複数ユーザー対応（チーム機能）
- [ ] 議事録のエクスポート（PDF、Word）
- [ ] カレンダー連携（Google Calendar）
- [ ] 音声ファイルの圧縮機能

### 9.3 長期（3-6ヶ月）

- [ ] リアルタイム文字起こし
- [ ] 話者分離機能
- [ ] 多言語対応
- [ ] モバイルアプリ（iOS/Android）

---

## 10. 付録

### 10.1 用語集

| 用語 | 説明 |
|------|------|
| RAG | Retrieval-Augmented Generation。検索拡張生成。 |
| Whisper | OpenAIの音声認識モデル |
| tRPC | TypeScript向けのRPCフレームワーク |
| Function Calling | LLMが関数を呼び出す機能 |
| ナレッジベース | 蓄積された知識のデータベース |

### 10.2 参考リンク

- [OpenAI Whisper API](https://platform.openai.com/docs/guides/speech-to-text)
- [tRPC Documentation](https://trpc.io/docs)
- [React 19](https://react.dev/)
- [Tailwind CSS](https://tailwindcss.com/)
- [shadcn/ui](https://ui.shadcn.com/)

### 10.3 変更履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2024-12-19 | 1.0.0 | 初版作成 |
| 2024-12-20 | 1.1.0 | 機能追加1-10 |
| 2024-12-20 | 1.2.0 | 機能追加11-16 |
| 2024-12-21 | 1.3.0 | 機能追加17-18 |
| 2024-12-21 | 2.0.0 | コンテキスト管理AI機能の追加（AI自動フォルダ管理、オンボーディング、外部連携、Obsidian風リンク、コンテンツ生成など） |

---

**文書作成日:** 2024年12月21日
**最終更新日:** 2024年12月21日
**作成者:** Manus AI
**バージョン:** 1.3.0
